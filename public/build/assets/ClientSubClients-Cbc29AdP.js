import{r,j as e,b as C}from"./app-BB65Mc1n.js";import{S as q}from"./separator-BWJbAkR8.js";import{DataTable as I}from"./data-table-B-3wHYvJ.js";import{subClientColumns as P}from"./columns-DpdiXNrm.js";import{I as o}from"./input-BdsrUm4j.js";import{L as d}from"./label-B29Fbpt8.js";import{t as c}from"./index-BD8g9cTJ.js";import{B as m}from"./button-AMd0rht4.js";import{D as w,b as y,c as F,d as E,e as L,f as T}from"./dialog-44kL--cs.js";import{A as R,a as W,b as _,c as G,d as J,e as K,f as Q,g as V,h as X}from"./alert-dialog-BkxvyqSV.js";import{S as Y}from"./square-pen-DOIaptEt.js";import{T as Z}from"./trash-2-CyBVRyGm.js";import"./index-C6WAMNeG.js";import"./index-BD0Aflgb.js";import"./utils-CytzSlOG.js";import"./table-Baebw86p.js";import"./select-Dp5Udnaz.js";import"./index-DJRbUwlk.js";import"./index-d89-VRCp.js";import"./index-CwOflKzf.js";import"./index-C6DuYNlM.js";import"./createLucideIcon-DhOTYlCm.js";import"./index--1ygw0mz.js";import"./index-Bax49BpN.js";import"./index-DbDOfuCE.js";import"./badge-BdYjlQZJ.js";import"./index-BwobEAja.js";import"./index-DwCxHBl2.js";function Ee({parentId:x}){const[k,p]=r.useState([]),[v,ee]=r.useState(""),[U,g]=r.useState(!1),[O,b]=r.useState(!1),[u,S]=r.useState({name:"",email:"",landline:"",mobile:""}),[n,f]=r.useState({name:"",email:""}),D=()=>{f({name:"",email:""})},A=()=>{S({name:"",email:"",landline:"",mobile:""}),D()},[i,N]=r.useState(null);r.useEffect(()=>{x&&(async()=>{try{console.log("Fetching sub-clients for parent:",x);const l=await C.get(`/customers/${x}/sub-clients`);console.log("Sub-clients response:",l.data),p(l.data)}catch(l){console.error("Error fetching sub-clients:",l),c.error("Failed to fetch sub-clients.")}})()},[x]);const t=(s,l)=>{const{name:a,value:j}=s.target;l==="add"?S(h=>({...h,[a]:j})):i&&N(h=>h?{...h,[a]:j}:null),f(h=>({...h,[a]:""}))},M=async()=>{var s;try{const l=await C.post("/sub-clients",{...u,parent_id:x});p(a=>[...a,l.data]),c.success("Sub-client successfully added!"),g(!1),A()}catch(l){c.error("Failed to add sub-client."),f(((s=l.response)==null?void 0:s.data.errors)||{})}},$=async()=>{var s;if(i){D();try{const l=await C.put(`/sub-clients/${i.id}`,i);p(a=>a.map(j=>j.id===i.id?l.data:j)),b(!1),c.success("Sub-client successfully updated!")}catch(l){(s=l.response)!=null&&s.data.errors?f(l.response.data.errors):c.error("Failed to update sub-client.")}}},z=async s=>{try{await C.delete(`/sub-clients/${s}`),p(l=>l.filter(a=>a.id!==s)),c.success("Sub-User successfully deleted!")}catch{c.error("Failed to delete sub-User.")}},B=k.filter(s=>s.name.toLowerCase().includes(v.toLowerCase())||s.email.toLowerCase().includes(v.toLowerCase())),H=[...P,{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"Actions"}),cell:({row:s})=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{N(s.original),b(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsxs(R,{children:[e.jsx(W,{asChild:!0,children:e.jsx(m,{variant:"destructive",size:"sm",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs(_,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Confirm Deletion"}),e.jsxs(K,{children:["Are you sure you want to delete ",e.jsx("b",{children:s.original.name}),"?"]})]}),e.jsxs(Q,{children:[e.jsx(V,{children:"Cancel"}),e.jsx(X,{onClick:()=>z(s.original.id),children:"Delete"})]})]})]})]})}];return e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Sub-Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add, edit, or delete sub-user for this customer."})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(m,{onClick:()=>g(!0),children:"Add Sub-Users"})})]}),e.jsx(q,{className:"my-4"}),e.jsx(I,{columns:H,data:B}),e.jsx(w,{open:U,onOpenChange:s=>{s||A(),g(s)},children:e.jsxs(y,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Add Sub-Users"}),e.jsx(L,{children:"Fill in the details for the new sub-user below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",name:"name",value:u.name,onChange:s=>t(s,"add")}),n.name&&e.jsx("p",{className:"text-red-600 text-sm",children:n.name})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",value:u.email,onChange:s=>t(s,"add")}),n.email&&e.jsx("p",{className:"text-red-600 text-sm",children:n.email})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"landline",children:"Landline"}),e.jsx(o,{id:"landline",name:"landline",value:u.landline,onChange:s=>t(s,"add")})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"mobile",children:"Mobile"}),e.jsx(o,{id:"mobile",name:"mobile",value:u.mobile,onChange:s=>t(s,"add")})]})]})}),e.jsxs(T,{children:[e.jsx(m,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(m,{onClick:M,children:"Add Sub-Client"})]})]})}),e.jsx(w,{open:O,onOpenChange:s=>b(s),children:e.jsxs(y,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Edit Sub-Client"}),e.jsx(L,{children:"Update the details for the sub-client below."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",name:"name",value:(i==null?void 0:i.name)||"",onChange:s=>t(s,"edit")}),n.name&&e.jsx("p",{className:"text-red-600 text-sm",children:n.name})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",value:(i==null?void 0:i.email)||"",onChange:s=>t(s,"edit")}),n.email&&e.jsx("p",{className:"text-red-600 text-sm",children:n.email})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"landline",children:"Landline"}),e.jsx(o,{id:"landline",name:"landline",value:(i==null?void 0:i.landline)||"",onChange:s=>t(s,"edit")})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"mobile",children:"Mobile"}),e.jsx(o,{id:"mobile",name:"mobile",value:(i==null?void 0:i.mobile)||"",onChange:s=>t(s,"edit")})]})]}),e.jsxs(T,{children:[e.jsx(m,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(m,{onClick:$,children:"Save Changes"})]})]})})]})}export{Ee as default};
