import{r as i,j as e,b as C}from"./app-BB65Mc1n.js";import{S as M,A as $,a as z,b as H,B as K,c as W,d as N,e as w,f as X}from"./breadcrumb-D6RxqHid.js";import{S as y}from"./separator-BWJbAkR8.js";import{B as d}from"./button-AMd0rht4.js";import{I as v}from"./input-BdsrUm4j.js";import{L as j}from"./label-B29Fbpt8.js";import{DataTable as Y}from"./data-table-B2-e1pLU.js";import{columns as G}from"./columns-Bzf06bzO.js";import{D as U,a as Z,b as ee,c as te,d as se,e as ae,f as oe}from"./dialog-44kL--cs.js";import{S as D,a as I,b as q,c as F,d as A}from"./select-Dp5Udnaz.js";import{t as p}from"./index-BD8g9cTJ.js";import{E as ie}from"./eye-zEeA36q9.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-BD0Aflgb.js";import"./index-d89-VRCp.js";import"./index-DJRbUwlk.js";import"./index-CwOflKzf.js";import"./index-C6WAMNeG.js";import"./index-C6DuYNlM.js";import"./createLucideIcon-DhOTYlCm.js";import"./index-DwCxHBl2.js";import"./index--1ygw0mz.js";import"./index-Bax49BpN.js";import"./index-D9Y9XxbS.js";import"./calendar-C06wmWHl.js";import"./table-Baebw86p.js";import"./index-DbDOfuCE.js";function Le({jobs:E,customers:J,collection_types:re,sanitisation_options:ne,status_options:Q}){const[T,le]=i.useState(E),[m,B]=i.useState(""),[r,b]=i.useState({}),[u,L]=i.useState(""),[f,_]=i.useState(!1),[k,x]=i.useState(!1),[o,h]=i.useState({job_id:"",client_id:"",collection_date:"",job_status:"Quote Requested",staff_collecting:"",vehicle:"",address:"",town_city:"",postcode:"",onsite_contact:"",onsite_number:"",onsite_email:"",collection_type:"",data_sanitisation:"",sla:"",instructions:""});i.useEffect(()=>{(async()=>{try{const s=await C.get("/quotes/next-job-id");B(s.data.next_job_id),h(a=>({...a,job_id:s.data.next_job_id}))}catch(s){console.error("Failed to fetch next job ID:",s)}})()},[]);const O=()=>b({}),R=t=>{const{name:s,value:a}=t.target;h(c=>({...c,[s]:a}))},g=(t,s)=>{h(a=>({...a,[t]:s}))},V=async()=>{var s,a,c,S;O();const t={};if(!o.job_id&&!m&&(t.job_id="Job ID is required"),o.client_id||(t.client_id="Customer is required"),Object.keys(t).length>0){b(t),p.error("Please fill in all required fields");return}try{_(!0);const n={job_id:o.job_id||m,client_id:parseInt(o.client_id),collection_date:o.collection_date||null,job_status:o.job_status||"Needs Scheduling",staff_collecting:"",vehicle:"",address:"",town_city:"",postcode:"",onsite_contact:"",onsite_number:"",onsite_email:"",collection_type:null,data_sanitisation:"",sla:"",instructions:""},l=await C.post("/quotes",n,{headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}});(l.status===201||l.status===200)&&(p.success("Job created successfully"),window.location.href=`/quotes/${l.data.id}`)}catch(n){console.error("Create error:",((a=n.response)==null?void 0:a.data)||n);const l=((S=(c=n.response)==null?void 0:c.data)==null?void 0:S.message)||"Failed to create job. Please try again.";p.error(l)}finally{_(!1),x(!1)}},P=[...G,{id:"actions",header:"Actions",cell:({row:t})=>{const s=t.original;return e.jsx("div",{className:"flex justify-end space-x-2",children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>window.location.href=`/quotes/${s.id}/`,children:e.jsx(ie,{className:"h-4 w-4"})})})}}];return e.jsxs(M,{children:[e.jsx($,{}),e.jsxs(z,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(H,{className:"-ml-1"}),e.jsx(y,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(K,{children:e.jsxs(W,{children:[e.jsx(N,{children:e.jsx(w,{href:"/dashboard",children:"Dashboard"})}),e.jsx(X,{}),e.jsx(N,{children:e.jsx(w,{href:"/quotes",children:"Quotes"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsx("div",{className:"text-3xl font-semibold text-gray-800",children:"Jobs: Quotes"}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Quotes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View and manage job quotes."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(v,{placeholder:"Search Jobs...",value:u,onChange:t=>L(t.target.value),className:"max-w-sm"}),e.jsxs(U,{open:k,onOpenChange:x,children:[e.jsx(Z,{asChild:!0,children:e.jsx(d,{children:"Create New Quote"})}),e.jsxs(ee,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(te,{children:[e.jsx(se,{children:"Create New Quote"}),e.jsx(ae,{children:"Fill in the basic details for the new quote. You can add more details after creation."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"job_id",children:"Job Number*"}),e.jsx(v,{id:"job_id",name:"job_id",value:o.job_id||m,onChange:t=>R(t)}),r.job_id&&e.jsx("p",{className:"text-red-600 text-sm",children:r.job_id})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"client_id",children:"Customer*"}),e.jsxs(D,{value:o.client_id,onValueChange:t=>g("client_id",t),children:[e.jsx(I,{children:e.jsx(q,{placeholder:"Select Customer"})}),e.jsx(F,{children:J.map(t=>e.jsx(A,{value:t.id.toString(),children:t.name},t.id))})]}),r.client_id&&e.jsx("p",{className:"text-red-600 text-sm",children:r.client_id})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"job_status",children:"Status*"}),e.jsxs(D,{value:o.job_status,onValueChange:t=>g("job_status",t),children:[e.jsx(I,{children:e.jsx(q,{placeholder:"Select Status"})}),e.jsx(F,{children:Q.filter(t=>["Quote Requested"].includes(t)).map(t=>e.jsx(A,{value:t,children:t},t))})]}),r.job_status&&e.jsx("p",{className:"text-red-600 text-sm",children:r.job_status})]})]}),e.jsxs(oe,{children:[e.jsx(d,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(d,{onClick:V,disabled:f,children:f?"Creating...":"Create Quote"})]})]})]})]})]}),e.jsx(y,{className:"my-4"}),e.jsx(Y,{columns:P,data:T.filter(t=>{var s,a;return t.job_id.toLowerCase().includes(u.toLowerCase())||((a=(s=t.client)==null?void 0:s.company_name)==null?void 0:a.toLowerCase().includes(u.toLowerCase()))})})]})]})]})]})}export{Le as default};
