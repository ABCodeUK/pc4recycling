import{r,j as e,b as C}from"./app-CxxjQbGd.js";import{S as $,A as z,a as H,b as M,B as R,c as W,d as N,e as v,f as Y}from"./breadcrumb-CVfpatPu.js";import{S as w}from"./separator-OWjsBv_k.js";import{B as c}from"./button-BfCUFj2v.js";import{I as p}from"./input-DPP4pqCX.js";import{L as d}from"./label-2wttpgDy.js";import{DataTable as G}from"./data-table-DTzAWfsn.js";import{columns as K}from"./columns-do1dVj0G.js";import{D as Q,a as U,b as X,c as Z,d as ee,e as se,f as te}from"./dialog-0RdKrRPh.js";import{S as y,a as D,b as I,c as F,d as J}from"./select-CnJHFvlZ.js";import{t as m}from"./index-CGbDflUn.js";import{E as ae}from"./eye-CPdCNAC_.js";import"./index-B6zYnIfL.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-uXkLkjFM.js";import"./createLucideIcon-YMZQpf5O.js";import"./index-CpwjmW8Z.js";import"./Combination-DnQhWoyI.js";import"./index-Drt13xjj.js";import"./index-DdQz_MXT.js";import"./index-Dy7fGhxC.js";import"./index-BlL_lDRx.js";import"./index---YqbKSt.js";import"./table-B3GsT3Yk.js";import"./badge-BZbc9Efx.js";import"./user-DL4jvKNs.js";function Le({jobs:A,customers:E,collection_types:ie,sanitisation_options:oe,status_options:B}){const[L,re]=r.useState(A),[x,T]=r.useState(""),[o,h]=r.useState({}),[j,k]=r.useState(""),[u,f]=r.useState(!1),[O,_]=r.useState(!1),[a,b]=r.useState({job_id:"",client_id:"",collection_date:"",job_status:"Needs Scheduling",staff_collecting:"",vehicle:"",address:"",town_city:"",postcode:"",onsite_contact:"",onsite_number:"",onsite_email:"",collection_type:"",data_sanitisation:"",sla:"",instructions:""});r.useEffect(()=>{(async()=>{try{const t=await C.get("/collections/next-job-id");T(t.data.next_job_id),b(i=>({...i,job_id:t.data.next_job_id}))}catch(t){console.error("Failed to fetch next job ID:",t)}})()},[]);const q=()=>h({}),g=s=>{const{name:t,value:i}=s.target;b(l=>({...l,[t]:i}))},S=(s,t)=>{b(i=>({...i,[s]:t}))},V=async()=>{var t,i;q();const s={};if(!a.job_id&&!x&&(s.job_id="Job ID is required"),a.client_id||(s.client_id="Customer is required"),a.collection_date||(s.collection_date="Collection date is required"),Object.keys(s).length>0){h(s),m.error("Please fill in all required fields");return}try{f(!0);const l={job_id:a.job_id||x,client_id:a.client_id,collection_date:a.collection_date,job_status:a.job_status},n=await C.post("/collections",l);n.data&&(m.success("Job created successfully!"),window.location.href=`/collections/${n.data.id}/edit`)}catch(l){if((i=(t=l.response)==null?void 0:t.data)!=null&&i.errors){h(l.response.data.errors);const n=Object.values(l.response.data.errors)[0];m.error(Array.isArray(n)?n[0]:n)}else m.error("Failed to create job. Please try again.")}finally{f(!1)}},P=[...K,{id:"actions",header:"Actions",cell:({row:s})=>{const t=s.original;return e.jsx("div",{className:"flex justify-end space-x-2",children:e.jsx(c,{variant:"outline",size:"sm",onClick:()=>window.location.href=`/collections/${t.id}/`,children:e.jsx(ae,{className:"h-4 w-4"})})})}}];return e.jsxs($,{children:[e.jsx(z,{}),e.jsxs(H,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(M,{className:"-ml-1"}),e.jsx(w,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(R,{children:e.jsxs(W,{children:[e.jsx(N,{children:e.jsx(v,{href:"/dashboard",children:"Dashboard"})}),e.jsx(Y,{}),e.jsx(N,{children:e.jsx(v,{href:"/collections",children:"Collections"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsx("div",{className:"text-3xl font-semibold text-gray-800",children:"Jobs: Collections"}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Collections"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View and manage collection jobs."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{placeholder:"Search Jobs...",value:j,onChange:s=>k(s.target.value),className:"max-w-sm"}),e.jsxs(Q,{open:O,onOpenChange:_,children:[e.jsx(U,{asChild:!0,children:e.jsx(c,{children:"Create New Job"})}),e.jsxs(X,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Create New Job"}),e.jsx(se,{children:"Fill in the basic details for the new job. You can add more details after creation."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"job_id",children:"Job Number*"}),e.jsx(p,{id:"job_id",name:"job_id",value:a.job_id||x,onChange:s=>g(s)}),o.job_id&&e.jsx("p",{className:"text-red-600 text-sm",children:o.job_id})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"client_id",children:"Customer*"}),e.jsxs(y,{value:a.client_id,onValueChange:s=>S("client_id",s),children:[e.jsx(D,{children:e.jsx(I,{placeholder:"Select Customer"})}),e.jsx(F,{children:E.map(s=>e.jsx(J,{value:s.id.toString(),children:s.name},s.id))})]}),o.client_id&&e.jsx("p",{className:"text-red-600 text-sm",children:o.client_id})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"collection_date",children:"Collection Date*"}),e.jsx(p,{id:"collection_date",name:"collection_date",type:"date",value:a.collection_date,onChange:s=>g(s)}),o.collection_date&&e.jsx("p",{className:"text-red-600 text-sm",children:o.collection_date})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"job_status",children:"Status*"}),e.jsxs(y,{value:a.job_status,onValueChange:s=>S("job_status",s),children:[e.jsx(D,{children:e.jsx(I,{placeholder:"Select Status"})}),e.jsx(F,{children:B.map(s=>e.jsx(J,{value:s,children:s},s))})]}),o.job_status&&e.jsx("p",{className:"text-red-600 text-sm",children:o.job_status})]})]}),e.jsxs(te,{children:[e.jsx(c,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsx(c,{onClick:V,disabled:u,children:u?"Creating...":"Create Job"})]})]})]})]})]}),e.jsx(w,{className:"my-4"}),e.jsx(G,{columns:P,data:L.filter(s=>{var t,i;return s.job_id.toLowerCase().includes(j.toLowerCase())||((i=(t=s.client)==null?void 0:t.company_name)==null?void 0:i.toLowerCase().includes(j.toLowerCase()))})})]})]})]})]})}export{Le as default};
