import{r,j as e,b as m}from"./app-Cma8V3l9.js";import{S as I}from"./separator-CEPuzrhi.js";import{DataTable as E}from"./data-table-CCayVwDf.js";import{clientJobColumns as L}from"./columns-CgNqaet8.js";import{I as h}from"./input-_RUYSLpp.js";import{L as j}from"./label-IUEK5zVZ.js";import{D as T,a as A,b as O,c as V,d as k,e as B,f as $}from"./dialog-C3tgJ_8I.js";import{S as H,a as M,b as P,c as R,d as q}from"./select-DcwlFvdE.js";import{t as n}from"./index-C_iezvca.js";import{B as p}from"./button-DS1ZOJ9c.js";import"./index-Dp-u-l4U.js";import"./index-DHxxav9I.js";import"./utils-CytzSlOG.js";import"./table-vJebbvAp.js";import"./badge-CVzXI77s.js";import"./index-BwobEAja.js";import"./arrow-up-down-BNv_JWN3.js";import"./createLucideIcon-BnM-jrHn.js";import"./user-DBoxPFyt.js";import"./eye-CSCMS_xt.js";import"./index-BH7C-wFc.js";import"./index-jFmiJHnk.js";import"./index-rOaI9F-v.js";import"./index-BUxlmQ7d.js";import"./index-CoYLIXTa.js";import"./index-CJRq-bCV.js";import"./index-Cdv8n69u.js";import"./index-CrYhDhYK.js";function Se({parentId:l}){const[S,_]=r.useState([]),[c,C]=r.useState(""),[w,x]=r.useState(!1),[u,D]=r.useState(""),[b,f]=r.useState(!1),[z,v]=r.useState({}),N=["Needs Scheduling","Scheduled","Postponed"],[i,d]=r.useState({job_id:"",collection_date:"",job_status:"Needs Scheduling"});r.useEffect(()=>{const t=async()=>{try{const s=await m.get(`/customers/${l}/jobs`);_(s.data)}catch{n.error("Failed to fetch jobs.")}},o=async()=>{try{const s=await m.get("/collections/next-job-id");D(s.data.next_job_id),d(a=>({...a,job_id:s.data.next_job_id}))}catch(s){console.error("Failed to fetch next job ID:",s)}};l&&(t(),o())},[l]);const g=t=>{const{name:o,value:s}=t.target;d(a=>({...a,[o]:s}))},J=t=>{d(o=>({...o,job_status:t}))},y=async()=>{var t,o;try{f(!0);const s={job_id:i.job_id||u,client_id:l,job_status:i.job_status,collection_date:i.collection_date||null},a=await m.post("/collections",s);a.data&&(n.success("Job created successfully!"),window.location.href=`/collections/${a.data.id}/edit`)}catch(s){(o=(t=s.response)==null?void 0:t.data)!=null&&o.errors?(v(s.response.data.errors),Object.values(s.response.data.errors).forEach(a=>{n.error(a[0])})):n.error("Failed to create job.")}finally{f(!1)}},F=S.filter(t=>t.job_id.toLowerCase().includes(c.toLowerCase())||t.address.toLowerCase().includes(c.toLowerCase()));return e.jsxs("section",{className:"bg-white border shadow rounded-lg",children:[e.jsx("header",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Manage Jobs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View and manage all jobs for this customer."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{placeholder:"Search Jobs...",value:c,onChange:t=>C(t.target.value),className:"max-w-sm"}),e.jsxs(T,{open:w,onOpenChange:x,children:[e.jsx(A,{asChild:!0,children:e.jsx(p,{children:"Add New Job"})}),e.jsxs(O,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(V,{children:[e.jsx(k,{children:"Create New Job"}),e.jsx(B,{children:"Fill in the details for the new job below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"job_id",children:"Job ID"}),e.jsx(h,{id:"job_id",name:"job_id",value:i.job_id||u,onChange:g})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"collection_date",children:"Collection Date (Optional)"}),e.jsx(h,{id:"collection_date",name:"collection_date",type:"date",value:i.collection_date,onChange:g})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"job_status",children:"Status"}),e.jsxs(H,{value:i.job_status,onValueChange:J,children:[e.jsx(M,{children:e.jsx(P,{placeholder:"Select status"})}),e.jsx(R,{children:N.map(t=>e.jsx(q,{value:t,children:t},t))})]})]})]})}),e.jsxs($,{children:[e.jsx(p,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(p,{onClick:y,disabled:b,children:b?"Creating...":"Create Job"})]})]})]})]})]})}),e.jsx(I,{}),e.jsx("div",{className:"p-6",children:e.jsx(E,{columns:L,data:F})})]})}export{Se as default};
