import{r as f,j as e,b as m}from"./app-BB65Mc1n.js";import{S as C,A as q,a as D,b as $,B as S,c as k,d as x,e as u,f as j}from"./breadcrumb-D6RxqHid.js";import{S as r}from"./separator-BWJbAkR8.js";import{B as h}from"./button-AMd0rht4.js";import{L as N}from"./label-B29Fbpt8.js";import{t as i}from"./index-BD8g9cTJ.js";import L from"./JobItems-mFpFHkZS.js";import{A}from"./arrow-left-Dk30N2JD.js";import{F as c}from"./file-text-BshKaKvK.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./input-BdsrUm4j.js";import"./dialog-44kL--cs.js";import"./index-DJRbUwlk.js";import"./index-CwOflKzf.js";import"./index-Bax49BpN.js";import"./index-C6WAMNeG.js";import"./index-BD0Aflgb.js";import"./index-DwCxHBl2.js";import"./createLucideIcon-DhOTYlCm.js";import"./index-d89-VRCp.js";import"./index-C6DuYNlM.js";import"./index--1ygw0mz.js";import"./index-D9Y9XxbS.js";import"./calendar-C06wmWHl.js";import"./tabs-D_Qtma4o.js";import"./data-table-BaToYgkX.js";import"./table-Baebw86p.js";import"./columns-BwvxXsta.js";import"./select-Dp5Udnaz.js";import"./index-DbDOfuCE.js";import"./maximize-2-IQ1HLsfM.js";import"./trash-2-CyBVRyGm.js";import"./processing-columns-D8x8XLyf.js";function ue({job:s,customers:v,documents:y}){const[l,b]=f.useState(y||{collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:[]});f.useState({collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:null});const a=({label:t,value:p})=>e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:t}),e.jsx("dd",{className:"text-sm text-gray-900 text-left",children:p||"-"})]}),_=t=>{switch(t){case"Scheduled":return"bg-green-100 text-green-800 border-green-200";case"Postponed":case"Cancelled":return"bg-red-100 text-red-800 border-red-200";case"Collected":case"Processing":case"Complete":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};v.find(t=>t.id===s.client_id);const w=s.collection_date?new Date(s.collection_date).toLocaleDateString():"-";return e.jsxs(C,{children:[e.jsx(q,{}),e.jsxs(D,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx($,{className:"-ml-1"}),e.jsx(r,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(S,{children:e.jsxs(k,{children:[e.jsx(x,{children:e.jsx(u,{href:"/dashboard",children:"Dashboard"})}),e.jsx(j,{}),e.jsx(x,{children:e.jsx(u,{href:"/my-collections",children:"My Collections"})}),e.jsx(j,{}),e.jsx(x,{children:e.jsx(u,{href:"#",children:"View Collection"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"text-3xl font-semibold text-gray-800",children:["Collection: ",s.job_id]}),e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:e.jsxs(h,{variant:"outline",onClick:()=>window.location.href="/my-collections/",children:[e.jsx(A,{className:"h-6 w-6"}),"Back to Collections"]})})]}),(s.job_quote||s.quote_information)&&["Quote Requested","Quote Received","Quote Rejected"].includes(s.job_status)&&e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Quote Information"}),e.jsx(r,{className:"my-4"}),s.job_quote&&e.jsxs("div",{className:"mb-4",children:[e.jsx(N,{htmlFor:"job_quote",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quote Amount"}),e.jsxs("div",{className:"text-lg font-semibold",children:["Â£",s.job_quote]})]}),s.quote_information&&e.jsxs("div",{className:"mb-6",children:[e.jsx(N,{htmlFor:"quote_information",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quote Details"}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.quote_information}})})]}),s.job_status==="Quote Received"&&e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx(h,{onClick:async()=>{try{await m.post(`/my-collections/${s.id}/accept-quote`),i.success("Quote accepted successfully"),window.location.reload()}catch(t){console.error("Error accepting quote:",t),i.error("Failed to accept quote")}},className:"bg-green-600 hover:bg-green-700",children:"Accept Quote"}),e.jsx(h,{variant:"destructive",onClick:async()=>{try{await m.post(`/my-collections/${s.id}/reject-quote`),i.success("Quote rejected"),window.location.reload()}catch(t){console.error("Error rejecting quote:",t),i.error("Failed to reject quote")}},children:"Reject Quote"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:["Collection Details",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${_(s.job_status)}`,children:s.job_status})]})]}),e.jsx(r,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(a,{label:"Job Number",value:s.job_id}),e.jsx(a,{label:"Collection Date",value:w}),e.jsx(r,{className:"my-2"}),e.jsx(a,{label:"Collection By",value:s.staff_collecting||"-"}),e.jsx(a,{label:"Vehicle Reistraton",value:s.vehicle||"-"}),e.jsx(a,{label:"Carrier Registration",value:s.driver_carrier_registration||"-"}),e.jsx(r,{className:"my-2"}),e.jsx(a,{label:"Address Line 1",value:s.address}),e.jsx(a,{label:"Address Line 2",value:s.address_2}),e.jsx(a,{label:"Town/City",value:s.town_city}),e.jsx(a,{label:"Postcode",value:s.postcode}),e.jsx(r,{className:"my-2"}),e.jsx(a,{label:"Onsite Contact",value:s.onsite_contact||"-"}),e.jsx(a,{label:"Onsite Number",value:s.onsite_number||"-"}),e.jsx(a,{label:"Onsite Email",value:s.onsite_email||"-"})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"More Information"}),e.jsx(r,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(a,{label:"Collection Type",value:s.collection_type||"-"}),e.jsx(a,{label:"Data Sanitisation",value:s.data_sanitisation||"-"}),e.jsx(a,{label:"Service Level Agreement",value:s.sla||"-"}),e.jsx(r,{className:"my-2"}),e.jsx(a,{label:"Equipment Location",value:s.equipment_location||"-"}),e.jsx(a,{label:"Building Access",value:s.building_access||"-"}),e.jsx(a,{label:"Collection Route",value:s.collection_route||"-"}),e.jsx(a,{label:"Parking & Loading",value:s.parking_loading||"-"}),e.jsx(a,{label:"Equipment Readiness",value:s.equipment_readiness||"-"}),e.jsx(r,{className:"my-2"}),e.jsxs("div",{className:"py-1",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Other Information"}),e.jsx("dd",{className:"mt-2 text-sm text-gray-900",children:s.instructions||"No instructions provided."})]})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Job Documents"}),e.jsx(r,{className:"my-4"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Collection Manifest"}),e.jsx("div",{className:"flex gap-2 items-center",children:l.collection_manifest?e.jsx(e.Fragment,{children:e.jsxs("a",{href:`/documents/${s.id}/${l.collection_manifest.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4"}),"View Document"]})}):e.jsx("div",{className:"flex gap-2 items-center",children:"-"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Hazard Waste Note"}),e.jsx("div",{className:"flex gap-2 items-center",children:l.hazard_waste_note?e.jsx(e.Fragment,{children:e.jsxs("a",{href:`/documents/${s.id}/${l.hazard_waste_note.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4"}),"View Document"]})}):e.jsx("div",{className:"flex gap-2 items-center",children:"-"})})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Data Destruction Certificate"}),e.jsx("div",{className:"flex gap-2 items-center",children:l.data_destruction_certificate?e.jsx(e.Fragment,{children:e.jsxs("a",{href:`/documents/${s.id}/${l.data_destruction_certificate.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4"}),"View Document"]})}):e.jsx("div",{className:"flex gap-2 items-center",children:"-"})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Other Documents"}),e.jsx("div",{className:"space-y-4",children:l.other.filter(t=>!t.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).length>0&&e.jsx("div",{className:"space-y-2",children:l.other.filter(t=>!t.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(t=>e.jsx("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:e.jsxs("a",{href:`/documents/${s.id}/${t.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4"}),t.original_filename]})},t.id))})})]}),e.jsx(r,{className:"my-4"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Collection Images"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center w-full",children:e.jsx("label",{className:"relative group cursor-pointer w-full",children:e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:t=>{Array.from(t.target.files||[]).forEach(o=>{const d=new FormData;d.append("document",o),d.append("document_type","other"),m.post(`/collections/${s.id}/documents`,d,{headers:{"Content-Type":"multipart/form-data"}}).then(n=>{n.data&&(b(g=>({...g,other:[...g.other,n.data.document]})),i.success(`Uploaded ${o.name}`))}).catch(n=>{console.error("Upload error:",n),i.error(`Failed to upload ${o.name}`)})})}})})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:l.other.filter(t=>t.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(t=>e.jsxs("div",{className:"relative group aspect-square",children:[e.jsx("img",{src:`/storage/${t.file_path}`,alt:t.original_filename,className:"w-full h-full object-cover rounded-lg shadow-sm"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-200 rounded-lg flex items-end justify-between p-2",children:e.jsx("a",{href:`/storage/${t.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/30 transition-colors",children:e.jsx(c,{className:"h-3.5 w-3.5 text-white"})})})]},t.id))})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("section",{children:e.jsx(L,{jobId:s.job_id,jobStatus:s.job_status})})})]})]})]})}export{ue as default};
