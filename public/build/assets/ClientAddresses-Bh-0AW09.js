import{r as x,j as e,b as g}from"./app-BB65Mc1n.js";import{S as I}from"./separator-BWJbAkR8.js";import{B as u}from"./button-AMd0rht4.js";import{I as l}from"./input-BdsrUm4j.js";import{L as c}from"./label-B29Fbpt8.js";import{DataTable as J}from"./data-table-CsXaBkf1.js";import{userAddressColumns as K}from"./columns-DXhuHmbw.js";import{t as m}from"./index-BD8g9cTJ.js";import{D as F,b as E,c as T,d as k,e as L,f as O}from"./dialog-44kL--cs.js";import{A as Q,a as V,b as X,c as Y,d as Z,e as ee,f as se,g as de,h as te}from"./alert-dialog-BkxvyqSV.js";import{S as re}from"./square-pen-DOIaptEt.js";import{T as ae}from"./trash-2-CyBVRyGm.js";import"./index-C6WAMNeG.js";import"./index-BD0Aflgb.js";import"./utils-CytzSlOG.js";import"./index-CwOflKzf.js";import"./index-BwobEAja.js";import"./table-Baebw86p.js";import"./select-Dp5Udnaz.js";import"./index-DJRbUwlk.js";import"./index-d89-VRCp.js";import"./index-C6DuYNlM.js";import"./createLucideIcon-DhOTYlCm.js";import"./index--1ygw0mz.js";import"./index-Bax49BpN.js";import"./index-DbDOfuCE.js";import"./index-DwCxHBl2.js";function Oe({parentId:p}){const[R,f]=x.useState([]),[v,$]=x.useState(null),[j,N]=x.useState({address:"",address_2:"",town_city:"",county:"",postcode:""}),[d,D]=x.useState(null),[t,y]=x.useState({address:"",address_2:"",town_city:"",county:"",postcode:""}),[P,oe]=x.useState(""),[z,A]=x.useState(!1),[B,w]=x.useState(!1);x.useEffect(()=>{p&&(async()=>{try{const o=(await g.get(`/addresses/${p}`)).data,r=(await g.get(`/customers/${p}/default-address`)).data;if(r){const n={id:-1,address:r.address||"",address_2:r.address_2||"",town_city:r.town_city||"",county:r.county||"",postcode:r.postcode||"",user_id:p};console.log("Default address data:",r),console.log("Created default row:",n),$(n)}f(o)}catch{m.error("Failed to fetch addresses.")}})()},[p]);const b=()=>y({address:"",address_2:"",town_city:"",county:"",postcode:""}),S=()=>{N({address:"",address_2:"",town_city:"",county:"",postcode:""}),b()},i=(s,a)=>{const{name:o,value:h}=s.target;a==="add"?N(r=>({...r,[o]:h})):d&&D(r=>r?{...r,[o]:h}:null),y(r=>({...r,[o]:""}))},H=async()=>{var s,a,o,h,r;try{const n={...j,parent_id:p};console.log("Sending payload:",n);const C=await g.post("/addresses",n);f(_=>[..._,C.data]),m.success("Address successfully added!"),A(!1),S()}catch(n){if(console.error("Error response:",(s=n.response)==null?void 0:s.data),(o=(a=n.response)==null?void 0:a.data)!=null&&o.errors){const C=n.response.data.errors;Object.entries(C).forEach(([_,G])=>{m.error(`${_}: ${G}`)}),y(n.response.data.errors)}else(r=(h=n.response)==null?void 0:h.data)!=null&&r.message?m.error(n.response.data.message):m.error("Failed to add address. Please try again.")}},q=async()=>{var s;if(d){b();try{const a=await g.put(`/addresses/${d.id}`,d);f(o=>o.map(h=>h.id===d.id?a.data:h)),w(!1),m.success("Address successfully updated!")}catch(a){(s=a.response)!=null&&s.data.errors?y(a.response.data.errors):m.error("Failed to update address.")}}},M=async s=>{try{await g.delete(`/addresses/${s}`),f(a=>a.filter(o=>o.id!==s)),m.success("Address successfully deleted!")}catch{m.error("Failed to delete address.")}},U=[...v?[v]:[],...R.filter(s=>s.address.toLowerCase().includes(P.toLowerCase()))],W=[...K,{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"Actions"}),cell:({row:s})=>s.original.id===-1?e.jsx("div",{className:"text-right text-muted-foreground",children:"(Default Address)"}):e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>{D(s.original),w(!0)},children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs(Q,{children:[e.jsx(V,{asChild:!0,children:e.jsx(u,{variant:"destructive",size:"sm",children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Confirm Deletion"}),e.jsx(ee,{children:"Are you sure you want to delete this address?"})]}),e.jsxs(se,{children:[e.jsx(de,{children:"Cancel"}),e.jsx(te,{onClick:()=>M(s.original.id),children:"Delete"})]})]})]})]})}];return e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Addresses"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add, edit, or delete addresses for this user."})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(u,{onClick:()=>A(!0),children:"Add Address"})})]}),e.jsx(I,{className:"my-4"}),e.jsx(J,{columns:W,data:U}),e.jsx(F,{open:z,onOpenChange:s=>{s||S(),A(s)},children:e.jsxs(E,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(T,{children:[e.jsx(k,{children:"Add Address"}),e.jsx(L,{children:"Fill in the details for the new address below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"address",children:"Address Line 1*"}),e.jsx(l,{id:"address",name:"address",value:j.address,onChange:s=>i(s,"add")}),t.address&&e.jsx("p",{className:"text-red-600 text-sm",children:t.address})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"address_2",children:"Address Line 2*"}),e.jsx(l,{id:"address_2",name:"address_2",value:j.address_2,onChange:s=>i(s,"add")}),t.address_2&&e.jsx("p",{className:"text-red-600 text-sm",children:t.address_2})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"town_city",children:"Town / City*"}),e.jsx(l,{id:"town_city",name:"town_city",value:j.town_city,onChange:s=>i(s,"add")}),t.town_city&&e.jsx("p",{className:"text-red-600 text-sm",children:t.town_city})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"county",children:"County"}),e.jsx(l,{id:"county",name:"county",value:j.county,onChange:s=>i(s,"add")}),t.county&&e.jsx("p",{className:"text-red-600 text-sm",children:t.county})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"postcode",children:"Postcode*"}),e.jsx(l,{id:"postcode",name:"postcode",value:j.postcode,onChange:s=>i(s,"add")}),t.postcode&&e.jsx("p",{className:"text-red-600 text-sm",children:t.postcode})]})]})}),e.jsxs(O,{children:[e.jsx(u,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsx(u,{onClick:H,children:"Add Address"})]})]})}),e.jsx(F,{open:B,onOpenChange:s=>w(s),children:e.jsxs(E,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(T,{children:[e.jsx(k,{children:"Edit Address"}),e.jsx(L,{children:"Update the details for the address below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"address",children:"Address"}),e.jsx(l,{id:"address",name:"address",value:(d==null?void 0:d.address)||"",onChange:s=>i(s,"edit")}),t.address&&e.jsx("p",{className:"text-red-600 text-sm",children:t.address})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"address_2",children:"Address Line 2"}),e.jsx(l,{id:"address_2",name:"address_2",value:(d==null?void 0:d.address_2)||"",onChange:s=>i(s,"edit")}),t.address_2&&e.jsx("p",{className:"text-red-600 text-sm",children:t.address_2})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"town_city",children:"Town / City"}),e.jsx(l,{id:"town_city",name:"town_city",value:(d==null?void 0:d.town_city)||"",onChange:s=>i(s,"edit")}),t.town_city&&e.jsx("p",{className:"text-red-600 text-sm",children:t.town_city})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"county",children:"County"}),e.jsx(l,{id:"county",name:"county",value:(d==null?void 0:d.county)||"",onChange:s=>i(s,"edit")}),t.county&&e.jsx("p",{className:"text-red-600 text-sm",children:t.county})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"postcode",children:"Postcode"}),e.jsx(l,{id:"postcode",name:"postcode",value:(d==null?void 0:d.postcode)||"",onChange:s=>i(s,"edit")}),t.postcode&&e.jsx("p",{className:"text-red-600 text-sm",children:t.postcode})]})]})}),e.jsxs(O,{children:[e.jsx(u,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(u,{onClick:q,children:"Save Changes"})]})]})})]})}export{Oe as default};
