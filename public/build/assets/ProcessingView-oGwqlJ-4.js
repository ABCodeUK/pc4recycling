import{r as z,j as e,b as S,h as P}from"./app-CNWjOMNx.js";import{S as I,A as T,a as q,b as R,B as J,c as U,d as w,e as D,f as A,R as m}from"./breadcrumb-BRBq9mE3.js";import{S as c}from"./separator-BPue9knr.js";import{B as o}from"./button-Cif8vmUM.js";import{I as _}from"./input-CKARXW-H.js";import{t as h}from"./index-DROTMuiR.js";import C from"./JobItems-C5CUaOjT.js";import O from"./JobAuditLog-D2B0PuSx.js";import{U as g}from"./upload-ixYMTL6b.js";import{A as $}from"./arrow-left-BoyVnRRs.js";import{S as V}from"./square-pen-DthIdKap.js";import{F as N}from"./file-text-q_c0toLx.js";import{T as v}from"./trash-2-UOQr6mTH.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./dialog-BfgzRhkV.js";import"./index-D-4-NTWd.js";import"./index-DPKFiV9N.js";import"./index-CnljWFNF.js";import"./index-BHpFse_T.js";import"./index-DUDCROMg.js";import"./index-BJMVI5o3.js";import"./createLucideIcon-ClQ1hqbp.js";import"./index-CmDO7QdU.js";import"./index-CNsmnkFI.js";import"./index-BqYSSVB3.js";import"./index-D0kbjZ6r.js";import"./calendar-BUGi4wxL.js";import"./tabs-plg5bBI7.js";import"./data-table-BhmYTfvA.js";import"./table-B5rCecqS.js";import"./columns-Cik7-og2.js";import"./select-DyBRev3z.js";import"./index-BflIAMo0.js";import"./maximize-2-U-dT6VrO.js";import"./processing-columns-BFhuZRdD.js";import"./textarea-BcChr0Fv.js";import"./badge-BpDmfbip.js";import"./pencil-DXCyqdQ8.js";function Ee({job:t,customers:E,documents:F}){const[l,f]=z.useState(F||{collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:[]}),[p,k]=z.useState({collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:null}),j=async a=>{const x=p[a];if(!x)return;const r=new FormData;r.append("document",x),r.append("document_type",a);try{const n=await S.post(`/collections/${t.id}/documents`,r,{headers:{"Content-Type":"multipart/form-data"}});n.data&&(f(a==="other"?d=>({...d,other:[...d.other,n.data.document]}):d=>({...d,[a]:n.data.document})),k(d=>({...d,[a]:null})),h.success("Document uploaded successfully"))}catch(n){console.error("Upload error:",n),h.error("Failed to upload document")}},y=(a,x)=>{var n;const r=(n=a.target.files)==null?void 0:n[0];if(r){if(r.size>134217728){h.error("File size must be less than 128MB"),a.target.value="";return}k(b=>({...b,[x]:r}))}};o,p.collection_manifest,g;const u=(a,x)=>{P.delete(`/collections/${t.id}/documents/${a}`,{preserveScroll:!0,onSuccess:()=>{f(x==="other"?r=>({...r,other:r.other.filter(n=>n.id!==a)}):r=>({...r,[x]:null})),h.success("Document deleted successfully")},onError:()=>{h.error("Failed to delete document")}})},i=({label:a,value:x})=>e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:a}),e.jsx("dd",{className:"text-sm text-gray-900 text-left",children:x||"-"})]}),B=a=>a==="Active"?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",L=a=>{switch(a){case"Scheduled":return"bg-green-100 text-green-800 border-green-200";case"Postponed":case"Cancelled":return"bg-red-100 text-red-800 border-red-200";case"Collected":case"Processing":case"Complete":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},s=E.find(a=>a.id===t.client_id),M=t.collection_date?new Date(t.collection_date).toLocaleDateString():"-";return e.jsxs(I,{children:[e.jsx(T,{}),e.jsxs(q,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(R,{className:"-ml-1"}),e.jsx(c,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(J,{children:e.jsxs(U,{children:[e.jsx(w,{children:e.jsx(D,{href:"/dashboard",children:"Dashboard"})}),e.jsx(A,{}),e.jsxs(m,{role:"Developer|Administrator|Employee|Manager|Director",children:[e.jsx(w,{children:e.jsx(D,{href:"/collections",children:"Collections"})}),e.jsx(A,{})]}),e.jsx(w,{children:e.jsx(D,{href:"#",children:"View Job"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"text-3xl font-semibold text-gray-800",children:["Processing: ",t.job_id]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(m,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsxs(o,{variant:"outline",onClick:()=>window.location.href="/processing",children:[e.jsx($,{className:"h-6 w-6"}),"Back to Processing"]})}),e.jsx(m,{role:"Drivers",children:e.jsxs(o,{variant:"outline",onClick:()=>window.location.href="/dashboard",children:[e.jsx($,{className:"h-6 w-6"}),"Back to Dashboard"]})}),e.jsx(m,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsxs(o,{onClick:()=>window.location.href=`/processing/${t.id}/edit`,children:[e.jsx(V,{className:"h-6 w-6"}),"Edit Job"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:["Job Details",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${L(t.job_status)}`,children:t.job_status})]})]}),e.jsx(c,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(i,{label:"Job Number",value:t.job_id}),e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Customer"}),e.jsxs("dd",{className:"text-sm text-left",children:[e.jsx(m,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx("a",{href:`/customers/${s==null?void 0:s.id}`,className:"text-primary hover:text-primary/90",children:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"})}),e.jsx(m,{role:"Drivers",children:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"})]})]}),e.jsx(i,{label:"Collection Date",value:M}),e.jsx(c,{className:"my-2"}),e.jsx(i,{label:"Collection By",value:t.staff_collecting||"-"}),e.jsx(i,{label:"Vehicle Reistraton",value:t.vehicle||"-"}),e.jsx(i,{label:"Carrier Registration",value:t.driver_carrier_registration||"-"}),e.jsx(c,{className:"my-2"}),e.jsx(i,{label:"Address Line 1",value:t.address}),e.jsx(i,{label:"Address Line 2",value:t.address_2}),e.jsx(i,{label:"Town/City",value:t.town_city}),e.jsx(i,{label:"Postcode",value:t.postcode}),e.jsx(c,{className:"my-2"}),e.jsx(i,{label:"Onsite Contact",value:t.onsite_contact||"-"}),e.jsx(i,{label:"Onsite Number",value:t.onsite_number||"-"}),e.jsx(i,{label:"Onsite Email",value:t.onsite_email||"-"})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"More Information"}),e.jsx(c,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(i,{label:"Collection Type",value:t.collection_type||"-"}),e.jsx(i,{label:"Data Sanitisation",value:t.data_sanitisation||"-"}),e.jsx(i,{label:"Service Level Agreement",value:t.sla||"-"}),e.jsx(c,{className:"my-2"}),e.jsx(i,{label:"Equipment Location",value:t.equipment_location||"-"}),e.jsx(i,{label:"Building Access",value:t.building_access||"-"}),e.jsx(i,{label:"Collection Route",value:t.collection_route||"-"}),e.jsx(i,{label:"Parking & Loading",value:t.parking_loading||"-"}),e.jsx(i,{label:"Equipment Readiness",value:t.equipment_readiness||"-"}),e.jsx(c,{className:"my-2"}),e.jsxs("div",{className:"py-1",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Other Information"}),e.jsx("dd",{className:"mt-2 text-sm text-gray-900",children:t.instructions||"No instructions provided."})]}),e.jsx(c,{className:"my-2"}),e.jsx("div",{className:"py-1",children:e.jsxs("dd",{className:"mt-2 text-sm text-gray-900",children:[e.jsx(i,{label:"Quoted Price",value:`Â£${t.job_quote||"-"} +VAT`}),e.jsx(i,{label:"Quote Information",value:t.quote_information||"-"})]})})]})]}),e.jsx(m,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:["Customer Details",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Account:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${B(s==null?void 0:s.account_status)}`,children:(s==null?void 0:s.account_status)||"Disabled"})]})]}),e.jsx(c,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(i,{label:"Company Name",value:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"}),e.jsx(i,{label:"Address Line 1",value:(s==null?void 0:s.address)||"-"}),e.jsx(i,{label:"Address Line 2",value:(s==null?void 0:s.address_2)||"-"}),e.jsx(i,{label:"Town/City",value:(s==null?void 0:s.town_city)||"-"}),e.jsx(i,{label:"County",value:(s==null?void 0:s.county)||"-"}),e.jsx(i,{label:"Postcode",value:(s==null?void 0:s.postcode)||"-"}),e.jsx(c,{className:"my-2"}),e.jsx(i,{label:"Contact Name",value:(s==null?void 0:s.contact_name)||"-"}),e.jsx(i,{label:"Position",value:(s==null?void 0:s.position)||"-"}),e.jsx(i,{label:"Landline",value:(s==null?void 0:s.landline)||"-"}),e.jsx(i,{label:"Mobile",value:(s==null?void 0:s.mobile)||"-"}),e.jsx(i,{label:"Email",value:(s==null?void 0:s.email)||"-"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx(m,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Job Documents"})}),e.jsx(m,{role:"Drivers",children:e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Collection Images"})}),e.jsx(c,{className:"my-4"}),e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{role:"Developer|Administrator|Employee|Manager|Director",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Collection Manifest"}),e.jsx("div",{className:"flex gap-2 items-center",children:l.collection_manifest?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${t.id}/${l.collection_manifest.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),l.collection_manifest.original_filename]}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>l.collection_manifest&&u(l.collection_manifest.id,"collection_manifest"),children:e.jsx(v,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{type:"file",accept:".pdf",onChange:a=>y(a,"collection_manifest")}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>j("collection_manifest"),disabled:!p.collection_manifest,children:e.jsx(g,{className:"h-4 w-4"})})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Hazard Waste Note"}),e.jsx("div",{className:"flex gap-2 items-center",children:l.hazard_waste_note?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${t.id}/${l.hazard_waste_note.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),l.hazard_waste_note.original_filename]}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>l.hazard_waste_note&&u(l.hazard_waste_note.id,"hazard_waste_note"),children:e.jsx(v,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{type:"file",accept:".pdf",onChange:a=>y(a,"hazard_waste_note")}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>j("hazard_waste_note"),disabled:!p.hazard_waste_note,children:e.jsx(g,{className:"h-4 w-4"})})]})})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Data Destruction Certificate"}),e.jsx("div",{className:"flex gap-2 items-center",children:l.data_destruction_certificate?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${t.id}/${l.data_destruction_certificate.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),l.data_destruction_certificate.original_filename]}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>l.data_destruction_certificate&&u(l.data_destruction_certificate.id,"data_destruction_certificate"),children:e.jsx(v,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{type:"file",accept:".pdf",onChange:a=>y(a,"data_destruction_certificate")}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>j("data_destruction_certificate"),disabled:!p.data_destruction_certificate,children:e.jsx(g,{className:"h-4 w-4"})})]})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Other Documents"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{type:"file",accept:".pdf",onChange:a=>y(a,"other")}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>j("other"),disabled:!p.other,children:e.jsx(g,{className:"h-4 w-4"})})]}),l.other.filter(a=>!a.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).length>0&&e.jsx("div",{className:"space-y-2",children:l.other.filter(a=>!a.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(a=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("a",{href:`/documents/${t.id}/${a.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),a.original_filename]}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>u(a.id,"other"),children:e.jsx(v,{className:"h-4 w-4 text-red-500"})})]},a.id))})]})]}),e.jsx(c,{className:"my-4"})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx(m,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Collection Images"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center w-full",children:e.jsxs("label",{className:"relative group cursor-pointer w-full",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>{Array.from(a.target.files||[]).forEach(r=>{const n=new FormData;n.append("document",r),n.append("document_type","other"),S.post(`/collections/${t.id}/documents`,n,{headers:{"Content-Type":"multipart/form-data"}}).then(d=>{d.data&&(f(b=>({...b,other:[...b.other,d.data.document]})),h.success(`Uploaded ${r.name}`))}).catch(d=>{console.error("Upload error:",d),h.error(`Failed to upload ${r.name}`)})})}}),e.jsx("div",{className:"flex items-center justify-center gap-4 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary transition-colors bg-gray-50/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"h-5 w-5 text-gray-400 group-hover:text-primary transition-colors"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-primary",children:"Upload images"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Drag and drop or click to select"})]})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:l.other.filter(a=>a.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(a=>e.jsxs("div",{className:"relative group aspect-square",children:[e.jsx("img",{src:`/storage/${a.file_path}`,alt:a.original_filename,className:"w-full h-full object-cover rounded-lg shadow-sm"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-200 rounded-lg flex items-end justify-between p-2",children:[e.jsx("a",{href:`/storage/${a.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/30 transition-colors",children:e.jsx(N,{className:"h-3.5 w-3.5 text-white"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>u(a.id,"other"),className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-full hover:bg-red-500/30 transition-colors",children:e.jsx(v,{className:"h-3.5 w-3.5 text-white"})})]})]},a.id))})]})]})]}),e.jsx(m,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx(O,{jobId:t.id})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("section",{children:e.jsx(C,{jobId:t.job_id,jobStatus:t.job_status})})})]})]})]})}export{Ee as default};
