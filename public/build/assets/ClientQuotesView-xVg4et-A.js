import{r as m,j as e,b as x,h as H}from"./app-CNWjOMNx.js";import{S as K,A as X,a as Z,b as ee,B as te,c as se,d as y,e as v,f as C}from"./breadcrumb-BRBq9mE3.js";import{S as c}from"./separator-BPue9knr.js";import{B as d}from"./button-Cif8vmUM.js";import{L as u}from"./label-EHUiVpis.js";import{I as f}from"./input-CKARXW-H.js";import ae from"./EditCollectionDetailsDialog-YMBaEt9q.js";import re from"./EditMoreInformationDialog-ChgzDTx6.js";import{t as a}from"./index-DROTMuiR.js";import ie from"./JobItems-C1HhOXI6.js";import{A as le}from"./arrow-left-BoyVnRRs.js";import{T as N}from"./trash-2-UOQr6mTH.js";import{U as S}from"./upload-ixYMTL6b.js";import{F as R}from"./file-text-q_c0toLx.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./dialog-BfgzRhkV.js";import"./index-D-4-NTWd.js";import"./index-DPKFiV9N.js";import"./index-CnljWFNF.js";import"./index-BHpFse_T.js";import"./index-DUDCROMg.js";import"./index-BJMVI5o3.js";import"./createLucideIcon-ClQ1hqbp.js";import"./index-CmDO7QdU.js";import"./index-CNsmnkFI.js";import"./index-BqYSSVB3.js";import"./index-D0kbjZ6r.js";import"./calendar-BUGi4wxL.js";import"./select-DyBRev3z.js";import"./index-BflIAMo0.js";import"./textarea-BcChr0Fv.js";import"./tabs-plg5bBI7.js";import"./data-table-C_Xa0KaH.js";import"./table-B5rCecqS.js";import"./columns-BknTiESp.js";import"./maximize-2-U-dT6VrO.js";function Ue({job:t,customers:b,addresses:$,sub_clients:T,documents:I}){const[E,w]=m.useState(!1),[A,q]=m.useState(!1),[h,L]=m.useState(t.requested_from_date||""),[p,P]=m.useState(t.requested_to_date||""),[D,B]=m.useState(t.requested_time||""),[j,_]=m.useState(I||{collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:[]}),[Q,F]=m.useState({collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:null}),z=async()=>{try{await x.post(`/api/quotes/${t.id}/mark-rejected`),a.success("Quote rejected successfully"),window.location.reload()}catch(s){console.error("Error rejecting quote:",s),a.error("Failed to reject quote")}},O=async()=>{try{await x.post(`/api/quotes/${t.id}/mark-accepted`),a.success("Quote Accepted successfully"),window.location.reload()}catch(s){console.error("Error accepting quote:",s),a.error("Failed to accept quote")}},M=async()=>{try{await x.delete(`/client/quotes/${t.id}`),a.success("Quote draft deleted successfully"),window.location.href="/my-quotes/"}catch(s){console.error("Error deleting quote draft:",s),a.error("Failed to delete quote draft")}},U=async s=>{const r=Q[s];if(!r)return;const i=new FormData;i.append("document",r),i.append("document_type",s);try{const o=await x.post(`/collections/${t.id}/documents`,i,{headers:{"Content-Type":"multipart/form-data"}});o.data&&(s==="other"&&_(n=>({...n,other:[...n.other,o.data.document]})),F(n=>({...n,[s]:null})),a.success("Document uploaded successfully"))}catch(o){console.error("Upload error:",o),a.error("Failed to upload document")}},V=(s,r)=>{var o;const i=(o=s.target.files)==null?void 0:o[0];if(i){if(i.size>134217728){a.error("File size must be less than 128MB"),s.target.value="";return}F(g=>({...g,[r]:i}))}},J=s=>{const r=s.target.value;if(p&&new Date(r)>new Date(p)){a.error("From date cannot be after the To date");return}L(r)},W=s=>{const r=s.target.value;if(h&&new Date(r)<new Date(h)){a.error("To date cannot be before the From date");return}P(r)},k=(s,r)=>{H.delete(`/collections/${t.id}/documents/${s}`,{preserveScroll:!0,onSuccess:()=>{_(i=>({...i,other:i.other.filter(o=>o.id!==s)})),a.success("Document deleted successfully")},onError:()=>{a.error("Failed to delete document")}})},l=({label:s,value:r})=>e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:s}),e.jsx("dd",{className:"text-sm text-gray-900 text-left",children:r||"-"})]}),Y=async()=>{try{await x.post(`/api/quotes/${t.id}/submit-request`,{requested_from_date:h,requested_to_date:p,requested_time:D}),a.success("Quote request submitted successfully"),window.location.reload()}catch(s){console.error("Error submitting quote request:",s),a.error("Failed to submit quote request")}},G=s=>{switch(s){case"Scheduled":return"bg-green-100 text-green-800 border-green-200";case"Postponed":case"Cancelled":return"bg-red-100 text-red-800 border-red-200";case"Collected":case"Processing":case"Complete":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return b.find(s=>s.id===t.client_id),t.collection_date&&new Date(t.collection_date).toLocaleDateString(),e.jsxs(K,{children:[e.jsx(X,{}),e.jsxs(Z,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(ee,{className:"-ml-1"}),e.jsx(c,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(te,{children:e.jsxs(se,{children:[e.jsx(y,{children:e.jsx(v,{href:"/dashboard",children:"Dashboard"})}),e.jsx(C,{}),e.jsx(y,{children:e.jsx(v,{href:"/my-quotes",children:"My Quotes"})}),e.jsx(C,{}),e.jsx(y,{children:e.jsx(v,{href:"#",children:"View Quotes"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"text-3xl font-semibold text-gray-800",children:["Quote: ",t.job_id]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(d,{variant:"outline",onClick:()=>window.location.href="/my-quotes/",children:[e.jsx(le,{className:"h-6 w-6"}),"Back to Quotes"]}),t.job_status==="Quote Draft"&&e.jsxs(d,{variant:"destructive",onClick:M,children:[e.jsx(N,{className:"h-6 w-6"}),"Delete Draft"]})]})]}),["Quote Draft","Quote Requested","Quote Provided","Quote Rejected"].includes(t.job_status)&&e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:[e.jsx("span",{children:"Quote Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${G(t.job_status)}`,children:t.job_status})]})]}),e.jsx(c,{className:"my-4"}),t.job_status==="Quote Draft"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"",children:[e.jsx("p",{className:"text-gray-700",children:"Please fill in the information on this page as best possible including the list of items that you would like us to collect from you and then submit your request."}),e.jsx("br",{}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("b",{children:"Please note: We will not receive your quote request until you have submitted the quote request using the button at the bottom of the page"}),"."]})]})}),t.job_status==="Quote Requested"&&e.jsx("div",{className:"",children:e.jsx("p",{className:"text-gray-700",children:"PC4 Recycling have received your recycling collection quote request and will respond with a quote and the proposed collection date."})}),t.job_status==="Quote Provided"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[t.job_quote&&e.jsxs("div",{className:"col-span-1",children:[e.jsx(u,{htmlFor:"job_quote",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quote Amount"}),e.jsxs("div",{className:"text-lg font-semibold",children:["Â£",t.job_quote," +VAT"]})]}),t.collection_date&&e.jsxs("div",{className:"col-span-1",children:[e.jsx(u,{htmlFor:"collection_date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Proposed Collection Date"}),e.jsx("div",{className:"text-lg",children:new Date(t.collection_date).toLocaleDateString()})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(u,{htmlFor:"job_status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quote Information"}),e.jsx("div",{className:"text-lg",children:t.quote_information})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(u,{htmlFor:"job_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference"}),e.jsx("div",{className:"text-lg",children:t.job_id})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx(d,{onClick:O,children:"Accept Quote"}),e.jsx(d,{variant:"destructive",onClick:z,children:"Reject Quote"})]})]}),t.job_status==="Quote Rejected"&&e.jsx("div",{className:"",children:e.jsx("p",{className:"text-gray-700",children:"You have rejected this quote. If you would like to request a new quote, please contact our customer service team."})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Collection Details"}),t.job_status==="Quote Draft"&&e.jsx(d,{variant:"outline",size:"sm",onClick:()=>w(!0),children:"Update"})]}),e.jsx(ae,{isOpen:E,onClose:()=>w(!1),jobId:t.id,initialData:{address:t.address,address_2:t.address_2,town_city:t.town_city,postcode:t.postcode,onsite_contact:t.onsite_contact,onsite_number:t.onsite_number,onsite_email:t.onsite_email},addresses:$,job:t,sub_clients:T,customers:b}),e.jsx(re,{isOpen:A,onClose:()=>q(!1),jobId:t.id,initialData:{instructions:t.instructions,equipment_location:t.equipment_location,building_access:t.building_access,collection_route:t.collection_route,parking_loading:t.parking_loading,equipment_readiness:t.equipment_readiness}}),e.jsx(c,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(l,{label:"Address Line 1",value:t.address}),e.jsx(l,{label:"Address Line 2",value:t.address_2}),e.jsx(l,{label:"Town/City",value:t.town_city}),e.jsx(l,{label:"Postcode",value:t.postcode}),e.jsx(c,{className:"my-2"}),e.jsx(l,{label:"Onsite Contact",value:t.onsite_contact||"-"}),e.jsx(l,{label:"Onsite Number",value:t.onsite_number||"-"}),e.jsx(l,{label:"Onsite Email",value:t.onsite_email||"-"})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"More Information"}),t.job_status==="Quote Draft"&&e.jsx(d,{variant:"outline",onClick:()=>q(!0),children:"Update"})]}),e.jsx(c,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[["Quote Requested","Quote Received","Quote Provided"].includes(t.job_status)&&e.jsxs(e.Fragment,{children:[e.jsx(l,{label:"Requested Dates",value:t.requested_from_date&&t.requested_to_date?`${new Date(t.requested_from_date).toLocaleDateString()} - ${new Date(t.requested_to_date).toLocaleDateString()}`:"-"}),e.jsx(l,{label:"Requested Time",value:t.requested_time||"-"}),e.jsx(c,{className:"my-2"})]}),e.jsx(l,{label:"Equipment Location",value:t.equipment_location||"-"}),e.jsx(l,{label:"Building Access",value:t.building_access||"-"}),e.jsx(l,{label:"Parking & Loading",value:t.parking_loading||"-"}),e.jsx(l,{label:"Equipment Readiness",value:t.equipment_readiness||"-"}),e.jsx(c,{className:"my-2"}),e.jsxs("div",{className:"py-1",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Other Information"}),e.jsx("dd",{className:"mt-2 text-sm text-gray-900",children:t.instructions||"No instructions provided."})]})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Job Documents"}),e.jsx(c,{className:"my-4"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Relevant Documents"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(f,{type:"file",accept:".pdf",onChange:s=>V(s,"other")}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>U("other"),disabled:!Q.other,children:e.jsx(S,{className:"h-4 w-4"})})]}),j.other.filter(s=>!s.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).length>0&&e.jsx("div",{className:"space-y-2",children:j.other.filter(s=>!s.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(s=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("a",{href:`/documents/${t.id}/${s.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s.original_filename]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>k(s.id),children:e.jsx(N,{className:"h-4 w-4 text-red-500"})})]},s.id))})]})]}),e.jsx(c,{className:"my-4"}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Collection Images"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center w-full",children:e.jsxs("label",{className:"relative group cursor-pointer w-full",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:s=>{Array.from(s.target.files||[]).forEach(i=>{const o=new FormData;o.append("document",i),o.append("document_type","other"),x.post(`/collections/${t.id}/documents`,o,{headers:{"Content-Type":"multipart/form-data"}}).then(n=>{n.data&&(_(g=>({...g,other:[...g.other,n.data.document]})),a.success(`Uploaded ${i.name}`))}).catch(n=>{console.error("Upload error:",n),a.error(`Failed to upload ${i.name}`)})})}}),e.jsx("div",{className:"flex items-center justify-center gap-4 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary transition-colors bg-gray-50/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"h-5 w-5 text-gray-400 group-hover:text-primary transition-colors"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-primary",children:"Upload images"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Drag and drop or click to select"})]})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:j.other.filter(s=>s.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(s=>e.jsxs("div",{className:"relative group aspect-square",children:[e.jsx("img",{src:`/storage/${s.file_path}`,alt:s.original_filename,className:"w-full h-full object-cover rounded-lg shadow-sm"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-200 rounded-lg flex items-end justify-between p-2",children:[e.jsx("a",{href:`/storage/${s.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/30 transition-colors",children:e.jsx(R,{className:"h-3.5 w-3.5 text-white"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>k(s.id),className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-full hover:bg-red-500/30 transition-colors",children:e.jsx(N,{className:"h-3.5 w-3.5 text-white"})})]})]},s.id))})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("section",{children:e.jsx(ie,{jobId:t.job_id,jobStatus:t.job_status})})}),["Quote Draft"].includes(t.job_status)&&e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:e.jsx("span",{children:"Submit Quote Request"})}),e.jsx(c,{className:"my-4"}),t.job_status==="Quote Draft"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-700",children:"If you have filled out the"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"requested_from_date",children:"From Date"}),e.jsx(f,{type:"date",id:"requested_from_date",value:h,onChange:J,max:p||void 0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"requested_to_date",children:"To Date"}),e.jsx(f,{type:"date",id:"requested_to_date",value:p,onChange:W,min:h||void 0})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"requested_time",children:"Preferred Time"}),e.jsx(f,{type:"text",id:"requested_time",value:D,onChange:s=>B(s.target.value),placeholder:"e.g. Morning, Afternoon, or specific time"})]}),e.jsx("div",{className:"flex gap-4 mt-4",children:e.jsx(d,{onClick:Y,children:"Submit Quote Request"})})]})]})]})]})]})}export{Ue as default};
