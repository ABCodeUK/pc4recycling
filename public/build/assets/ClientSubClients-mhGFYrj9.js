import{r,j as e,b as C}from"./app-C9fBnuOE.js";import{S as q}from"./separator-qcrg4dPm.js";import{DataTable as I}from"./data-table-B2-vr8j5.js";import{subClientColumns as P}from"./columns-D3uw06Wz.js";import{I as o}from"./input-qWEfNBQH.js";import{L as d}from"./label-DXs1eXQv.js";import{t as c}from"./index-BFwC0R9V.js";import{B as m}from"./button-B_fIfnBb.js";import{D as w,b as y,c as F,d as E,e as L,f as T}from"./dialog-CjVGXQRN.js";import{A as R,a as W,b as _,c as G,d as J,e as K,f as Q,g as V,h as X}from"./alert-dialog-0S9w3esk.js";import{S as Y}from"./square-pen-TNSEbh-R.js";import{T as Z}from"./trash-2-nXxqySza.js";import"./index-CsWbMgBq.js";import"./index-Ds3v4yF_.js";import"./utils-CytzSlOG.js";import"./table-DZdrIWYD.js";import"./select-Dl6e1rl2.js";import"./index-Dfe5dhDQ.js";import"./index-B-UXHqoX.js";import"./createLucideIcon-D4c-ObJW.js";import"./index-CNTKN5Ut.js";import"./index-DUsJq6sw.js";import"./badge-BZp_ungW.js";import"./index-BwobEAja.js";import"./index-JjatSUmS.js";import"./index-CWtl1gFV.js";function ye({parentId:x}){const[k,p]=r.useState([]),[v,ee]=r.useState(""),[U,g]=r.useState(!1),[O,b]=r.useState(!1),[u,S]=r.useState({name:"",email:"",landline:"",mobile:""}),[n,f]=r.useState({name:"",email:""}),D=()=>{f({name:"",email:""})},A=()=>{S({name:"",email:"",landline:"",mobile:""}),D()},[l,N]=r.useState(null);r.useEffect(()=>{x&&(async()=>{try{console.log("Fetching sub-clients for parent:",x);const a=await C.get(`/customers/${x}/sub-clients`);console.log("Sub-clients response:",a.data),p(a.data)}catch(a){console.error("Error fetching sub-clients:",a),c.error("Failed to fetch sub-clients.")}})()},[x]);const t=(s,a)=>{const{name:i,value:j}=s.target;a==="add"?S(h=>({...h,[i]:j})):l&&N(h=>h?{...h,[i]:j}:null),f(h=>({...h,[i]:""}))},M=async()=>{var s;try{const a=await C.post("/sub-clients",{...u,parent_id:x});p(i=>[...i,a.data]),c.success("Sub-client successfully added!"),g(!1),A()}catch(a){c.error("Failed to add sub-client."),f(((s=a.response)==null?void 0:s.data.errors)||{})}},$=async()=>{var s;if(l){D();try{const a=await C.put(`/sub-clients/${l.id}`,l);p(i=>i.map(j=>j.id===l.id?a.data:j)),b(!1),c.success("Sub-client successfully updated!")}catch(a){(s=a.response)!=null&&s.data.errors?f(a.response.data.errors):c.error("Failed to update sub-client.")}}},z=async s=>{try{await C.delete(`/sub-clients/${s}`),p(a=>a.filter(i=>i.id!==s)),c.success("Sub-User successfully deleted!")}catch{c.error("Failed to delete sub-User.")}},B=k.filter(s=>s.name.toLowerCase().includes(v.toLowerCase())||s.email.toLowerCase().includes(v.toLowerCase())),H=[...P,{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"Actions"}),cell:({row:s})=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{N(s.original),b(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsxs(R,{children:[e.jsx(W,{asChild:!0,children:e.jsx(m,{variant:"destructive",size:"sm",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs(_,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Confirm Deletion"}),e.jsxs(K,{children:["Are you sure you want to delete ",e.jsx("b",{children:s.original.name}),"?"]})]}),e.jsxs(Q,{children:[e.jsx(V,{children:"Cancel"}),e.jsx(X,{onClick:()=>z(s.original.id),children:"Delete"})]})]})]})]})}];return e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Sub-Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add, edit, or delete sub-user for this customer."})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(m,{onClick:()=>g(!0),children:"Add Sub-Users"})})]}),e.jsx(q,{className:"my-4"}),e.jsx(I,{columns:H,data:B}),e.jsx(w,{open:U,onOpenChange:s=>{s||A(),g(s)},children:e.jsxs(y,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Add Sub-Users"}),e.jsx(L,{children:"Fill in the details for the new sub-user below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",name:"name",value:u.name,onChange:s=>t(s,"add")}),n.name&&e.jsx("p",{className:"text-red-600 text-sm",children:n.name})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",value:u.email,onChange:s=>t(s,"add")}),n.email&&e.jsx("p",{className:"text-red-600 text-sm",children:n.email})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"landline",children:"Landline"}),e.jsx(o,{id:"landline",name:"landline",value:u.landline,onChange:s=>t(s,"add")})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"mobile",children:"Mobile"}),e.jsx(o,{id:"mobile",name:"mobile",value:u.mobile,onChange:s=>t(s,"add")})]})]})}),e.jsxs(T,{children:[e.jsx(m,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(m,{onClick:M,children:"Add Sub-Client"})]})]})}),e.jsx(w,{open:O,onOpenChange:s=>b(s),children:e.jsxs(y,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Edit Sub-Client"}),e.jsx(L,{children:"Update the details for the sub-client below."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",name:"name",value:(l==null?void 0:l.name)||"",onChange:s=>t(s,"edit")}),n.name&&e.jsx("p",{className:"text-red-600 text-sm",children:n.name})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",value:(l==null?void 0:l.email)||"",onChange:s=>t(s,"edit")}),n.email&&e.jsx("p",{className:"text-red-600 text-sm",children:n.email})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"landline",children:"Landline"}),e.jsx(o,{id:"landline",name:"landline",value:(l==null?void 0:l.landline)||"",onChange:s=>t(s,"edit")})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"mobile",children:"Mobile"}),e.jsx(o,{id:"mobile",name:"mobile",value:(l==null?void 0:l.mobile)||"",onChange:s=>t(s,"edit")})]})]}),e.jsxs(T,{children:[e.jsx(m,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(m,{onClick:$,children:"Save Changes"})]})]})})]})}export{ye as default};
