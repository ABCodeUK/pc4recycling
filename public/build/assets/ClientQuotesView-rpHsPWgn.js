import{r as n,j as e,b as o}from"./app-BB65Mc1n.js";import{S as I,A as R,a as $,b as F,B as A,c as L,d as p,e as h,f as y}from"./breadcrumb-D6RxqHid.js";import{S as i}from"./separator-BWJbAkR8.js";import{B as l}from"./button-AMd0rht4.js";import{L as d}from"./label-B29Fbpt8.js";import O from"./EditCollectionDetailsDialog-u1etgagA.js";import B from"./EditMoreInformationDialog-B5IlaubB.js";import{t as r}from"./index-BD8g9cTJ.js";import P from"./JobItems-Dwpr6q08.js";import{A as M}from"./arrow-left-Dk30N2JD.js";import{T}from"./trash-2-CyBVRyGm.js";import{F as _}from"./file-text-BshKaKvK.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./input-BdsrUm4j.js";import"./dialog-44kL--cs.js";import"./index-DJRbUwlk.js";import"./index-CwOflKzf.js";import"./index-Bax49BpN.js";import"./index-C6WAMNeG.js";import"./index-BD0Aflgb.js";import"./index-DwCxHBl2.js";import"./createLucideIcon-DhOTYlCm.js";import"./index-d89-VRCp.js";import"./index-C6DuYNlM.js";import"./index--1ygw0mz.js";import"./index-D9Y9XxbS.js";import"./calendar-C06wmWHl.js";import"./textarea-DrPmTigR.js";import"./tabs-D_Qtma4o.js";import"./data-table-tQ-UeZMJ.js";import"./table-Baebw86p.js";import"./columns-CjI3qSIB.js";import"./select-Dp5Udnaz.js";import"./index-DbDOfuCE.js";import"./maximize-2-IQ1HLsfM.js";function Qe({job:s,customers:b,addresses:U,sub_clients:z,documents:v}){const[w,g]=n.useState(!1),[q,f]=n.useState(!1),[m,D]=n.useState(v||{collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:[]});n.useState({collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:null});const Q=async()=>{try{await o.post(`/api/quotes/${s.id}/mark-rejected`),r.success("Quote rejected successfully"),window.location.reload()}catch(t){console.error("Error rejecting quote:",t),r.error("Failed to reject quote")}},k=async()=>{try{await o.post(`/api/quotes/${s.id}/mark-accepted`),r.success("Quote Accepted successfully"),window.location.reload()}catch(t){console.error("Error accepting quote:",t),r.error("Failed to accept quote")}},C=async()=>{try{await o.delete(`/client/quotes/${s.id}`),r.success("Quote draft deleted successfully"),window.location.href="/my-quotes/"}catch(t){console.error("Error deleting quote draft:",t),r.error("Failed to delete quote draft")}},a=({label:t,value:j})=>e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:t}),e.jsx("dd",{className:"text-sm text-gray-900 text-left",children:j||"-"})]}),S=async()=>{try{await o.post(`/api/quotes/${s.id}/submit-request`),r.success("Quote request submitted successfully"),window.location.reload()}catch(t){console.error("Error submitting quote request:",t),r.error("Failed to submit quote request")}},E=t=>{switch(t){case"Scheduled":return"bg-green-100 text-green-800 border-green-200";case"Postponed":case"Cancelled":return"bg-red-100 text-red-800 border-red-200";case"Collected":case"Processing":case"Complete":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return b.find(t=>t.id===s.client_id),s.collection_date&&new Date(s.collection_date).toLocaleDateString(),e.jsxs(I,{children:[e.jsx(R,{}),e.jsxs($,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(F,{className:"-ml-1"}),e.jsx(i,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(A,{children:e.jsxs(L,{children:[e.jsx(p,{children:e.jsx(h,{href:"/dashboard",children:"Dashboard"})}),e.jsx(y,{}),e.jsx(p,{children:e.jsx(h,{href:"/my-quotes",children:"My Quotes"})}),e.jsx(y,{}),e.jsx(p,{children:e.jsx(h,{href:"#",children:"View Quotes"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"text-3xl font-semibold text-gray-800",children:["Quote: ",s.job_id]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(l,{variant:"outline",onClick:()=>window.location.href="/my-quotes/",children:[e.jsx(M,{className:"h-6 w-6"}),"Back to Quotes"]}),s.job_status==="Quote Draft"&&e.jsxs(l,{variant:"destructive",onClick:C,children:[e.jsx(T,{className:"h-6 w-6"}),"Delete Draft"]})]})]}),["Quote Draft","Quote Requested","Quote Provided","Quote Rejected"].includes(s.job_status)&&e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:[e.jsx("span",{children:"Quote Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${E(s.job_status)}`,children:s.job_status})]})]}),e.jsx(i,{className:"my-4"}),s.job_status==="Quote Draft"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-700",children:'Please fill in the information below as best possible including the list of items that you would like us to collect from you. Once done, please click the "Submit Quote Request" button below to send your request to us.'})}),e.jsx("div",{className:"flex gap-4 mt-4",children:e.jsx(l,{onClick:S,children:"Submit Quote Request"})})]}),s.job_status==="Quote Requested"&&e.jsx("div",{className:"",children:e.jsx("p",{className:"text-gray-700",children:"PC4 Recycling have received your recycling collection quote request and will respond with a quote and the proposed collection date."})}),s.job_status==="Quote Provided"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[s.job_quote&&e.jsxs("div",{className:"col-span-1",children:[e.jsx(d,{htmlFor:"job_quote",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quote Amount"}),e.jsxs("div",{className:"text-lg font-semibold",children:["Â£",s.job_quote," +VAT"]})]}),s.collection_date&&e.jsxs("div",{className:"col-span-1",children:[e.jsx(d,{htmlFor:"collection_date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Proposed Collection Date"}),e.jsx("div",{className:"text-lg",children:new Date(s.collection_date).toLocaleDateString()})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(d,{htmlFor:"job_status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quote Information"}),e.jsx("div",{className:"text-lg",children:s.quote_information})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(d,{htmlFor:"job_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference"}),e.jsx("div",{className:"text-lg",children:s.job_id})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx(l,{onClick:k,children:"Accept Quote"}),e.jsx(l,{variant:"destructive",onClick:Q,children:"Reject Quote"})]})]}),s.job_status==="Quote Rejected"&&e.jsx("div",{className:"",children:e.jsx("p",{className:"text-gray-700",children:"You have rejected this quote. If you would like to request a new quote, please contact our customer service team."})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Collection Details"}),s.job_status==="Quote Draft"&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>g(!0),children:"Update"})]}),e.jsx(O,{isOpen:w,onClose:()=>g(!1),jobId:s.id,initialData:{address:s.address,address_2:s.address_2,town_city:s.town_city,postcode:s.postcode,onsite_contact:s.onsite_contact,onsite_number:s.onsite_number,onsite_email:s.onsite_email}}),e.jsx(B,{isOpen:q,onClose:()=>f(!1),jobId:s.id,initialData:{instructions:s.instructions,equipment_location:s.equipment_location,building_access:s.building_access,collection_route:s.collection_route,parking_loading:s.parking_loading,equipment_readiness:s.equipment_readiness}}),e.jsx(i,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(a,{label:"Address Line 1",value:s.address}),e.jsx(a,{label:"Address Line 2",value:s.address_2}),e.jsx(a,{label:"Town/City",value:s.town_city}),e.jsx(a,{label:"Postcode",value:s.postcode}),e.jsx(i,{className:"my-2"}),e.jsx(a,{label:"Onsite Contact",value:s.onsite_contact||"-"}),e.jsx(a,{label:"Onsite Number",value:s.onsite_number||"-"}),e.jsx(a,{label:"Onsite Email",value:s.onsite_email||"-"})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"More Information"}),s.job_status==="Quote Draft"&&e.jsx(l,{variant:"outline",onClick:()=>f(!0),children:"Update"})]}),e.jsx(i,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(a,{label:"Equipment Location",value:s.equipment_location||"-"}),e.jsx(a,{label:"Building Access",value:s.building_access||"-"}),e.jsx(a,{label:"Parking & Loading",value:s.parking_loading||"-"}),e.jsx(a,{label:"Equipment Readiness",value:s.equipment_readiness||"-"}),e.jsx(i,{className:"my-2"}),e.jsxs("div",{className:"py-1",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Other Information"}),e.jsx("dd",{className:"mt-2 text-sm text-gray-900",children:s.instructions||"No instructions provided."})]})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Job Documents"}),e.jsx(i,{className:"my-4"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Relevant Documents"}),e.jsx("div",{className:"space-y-4",children:m.other.filter(t=>!t.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).length>0&&e.jsx("div",{className:"space-y-2",children:m.other.filter(t=>!t.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(t=>e.jsx("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:e.jsxs("a",{href:`/documents/${s.id}/${t.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),t.original_filename]})},t.id))})})]}),e.jsx(i,{className:"my-4"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Collection Images"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center w-full",children:e.jsx("label",{className:"relative group cursor-pointer w-full",children:e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:t=>{Array.from(t.target.files||[]).forEach(u=>{const x=new FormData;x.append("document",u),x.append("document_type","other"),o.post(`/collections/${s.id}/documents`,x,{headers:{"Content-Type":"multipart/form-data"}}).then(c=>{c.data&&(D(N=>({...N,other:[...N.other,c.data.document]})),r.success(`Uploaded ${u.name}`))}).catch(c=>{console.error("Upload error:",c),r.error(`Failed to upload ${u.name}`)})})}})})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:m.other.filter(t=>t.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(t=>e.jsxs("div",{className:"relative group aspect-square",children:[e.jsx("img",{src:`/storage/${t.file_path}`,alt:t.original_filename,className:"w-full h-full object-cover rounded-lg shadow-sm"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-200 rounded-lg flex items-end justify-between p-2",children:e.jsx("a",{href:`/storage/${t.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/30 transition-colors",children:e.jsx(_,{className:"h-3.5 w-3.5 text-white"})})})]},t.id))})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("section",{children:e.jsx(P,{jobId:s.job_id,jobStatus:s.job_status})})})]})]})]})}export{Qe as default};
