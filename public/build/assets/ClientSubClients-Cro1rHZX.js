import{r,j as e,b as C}from"./app-DGedXpK6.js";import{S as I}from"./separator-Qg1edzKM.js";import{DataTable as P}from"./data-table-CLwnW5sG.js";import{subClientColumns as R}from"./columns-mPfiANX4.js";import{I as o}from"./input-CkBA5yRJ.js";import{L as d}from"./label-Ct80BZdK.js";import{t as c}from"./index-B34HRg7w.js";import{B as m}from"./button-DjXm1grC.js";import{D as w,b as y,c as F,d as E,e as L,f as T}from"./dialog-CjHGOGdp.js";import{A as U,a as W,b as _,c as G,d as J,e as K,f as Q,g as V,h as X}from"./alert-dialog-FwAlGMcx.js";import{S as Y}from"./square-pen-DAP9x76s.js";import{T as Z}from"./trash-2-CE_77rkt.js";import"./index-Crf3phMa.js";import"./index-B_qNjpXx.js";import"./index-Dx4p5O6H.js";import"./index-BOJ2gww-.js";import"./utils-CytzSlOG.js";import"./table-Cj_Afe3x.js";import"./select-DuTKz2sq.js";import"./index-BNfd2_2U.js";import"./index-CLFtQT3G.js";import"./createLucideIcon-C-iaKTyE.js";import"./badge-D5z1vypp.js";import"./index-BwobEAja.js";import"./index-D1brpkaJ.js";import"./index-CvV_Mgk0.js";function ye({parentId:x}){const[k,p]=r.useState([]),[v,ee]=r.useState(""),[O,g]=r.useState(!1),[M,b]=r.useState(!1),[u,S]=r.useState({name:"",email:"",landline:"",mobile:""}),[n,f]=r.useState({name:"",email:""}),D=()=>{f({name:"",email:""})},A=()=>{S({name:"",email:"",landline:"",mobile:""}),D()},[l,N]=r.useState(null);r.useEffect(()=>{x&&(async()=>{try{console.log("Fetching sub-clients for parent:",x);const i=await C.get(`/customers/${x}/sub-clients`);console.log("Sub-clients response:",i.data),p(i.data)}catch(i){console.error("Error fetching sub-clients:",i),c.error("Failed to fetch sub-clients.")}})()},[x]);const t=(s,i)=>{const{name:a,value:j}=s.target;i==="add"?S(h=>({...h,[a]:j})):l&&N(h=>h?{...h,[a]:j}:null),f(h=>({...h,[a]:""}))},$=async()=>{var s;try{const i=await C.post("/sub-clients",{...u,parent_id:x});p(a=>[...a,i.data]),c.success("Sub-client successfully added!"),g(!1),A()}catch(i){c.error("Failed to add sub-client."),f(((s=i.response)==null?void 0:s.data.errors)||{})}},z=async()=>{var s;if(l){D();try{const i=await C.put(`/sub-clients/${l.id}`,l);p(a=>a.map(j=>j.id===l.id?i.data:j)),b(!1),c.success("Sub-client successfully updated!")}catch(i){(s=i.response)!=null&&s.data.errors?f(i.response.data.errors):c.error("Failed to update sub-client.")}}},B=async s=>{try{await C.delete(`/sub-clients/${s}`),p(i=>i.filter(a=>a.id!==s)),c.success("Sub-client successfully deleted!")}catch{c.error("Failed to delete sub-client.")}},H=k.filter(s=>s.name.toLowerCase().includes(v.toLowerCase())||s.email.toLowerCase().includes(v.toLowerCase())),q=[...R,{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"Actions"}),cell:({row:s})=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{N(s.original),b(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsxs(U,{children:[e.jsx(W,{asChild:!0,children:e.jsx(m,{variant:"destructive",size:"sm",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs(_,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Confirm Deletion"}),e.jsxs(K,{children:["Are you sure you want to delete ",e.jsx("b",{children:s.original.name}),"?"]})]}),e.jsxs(Q,{children:[e.jsx(V,{children:"Cancel"}),e.jsx(X,{onClick:()=>B(s.original.id),children:"Delete"})]})]})]})]})}];return e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Sub-Clients"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add, edit, or delete sub-clients for this customer."})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(m,{onClick:()=>g(!0),children:"Add Sub-Client"})})]}),e.jsx(I,{className:"my-4"}),e.jsx(P,{columns:q,data:H}),e.jsx(w,{open:O,onOpenChange:s=>{s||A(),g(s)},children:e.jsxs(y,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Add Sub-Client"}),e.jsx(L,{children:"Fill in the details for the new sub-client below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",name:"name",value:u.name,onChange:s=>t(s,"add")}),n.name&&e.jsx("p",{className:"text-red-600 text-sm",children:n.name})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",value:u.email,onChange:s=>t(s,"add")}),n.email&&e.jsx("p",{className:"text-red-600 text-sm",children:n.email})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"landline",children:"Landline"}),e.jsx(o,{id:"landline",name:"landline",value:u.landline,onChange:s=>t(s,"add")})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"mobile",children:"Mobile"}),e.jsx(o,{id:"mobile",name:"mobile",value:u.mobile,onChange:s=>t(s,"add")})]})]})}),e.jsxs(T,{children:[e.jsx(m,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(m,{onClick:$,children:"Add Sub-Client"})]})]})}),e.jsx(w,{open:M,onOpenChange:s=>b(s),children:e.jsxs(y,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(F,{children:[e.jsx(E,{children:"Edit Sub-Client"}),e.jsx(L,{children:"Update the details for the sub-client below."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",name:"name",value:(l==null?void 0:l.name)||"",onChange:s=>t(s,"edit")}),n.name&&e.jsx("p",{className:"text-red-600 text-sm",children:n.name})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",value:(l==null?void 0:l.email)||"",onChange:s=>t(s,"edit")}),n.email&&e.jsx("p",{className:"text-red-600 text-sm",children:n.email})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"landline",children:"Landline"}),e.jsx(o,{id:"landline",name:"landline",value:(l==null?void 0:l.landline)||"",onChange:s=>t(s,"edit")})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"mobile",children:"Mobile"}),e.jsx(o,{id:"mobile",name:"mobile",value:(l==null?void 0:l.mobile)||"",onChange:s=>t(s,"edit")})]})]}),e.jsxs(T,{children:[e.jsx(m,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(m,{onClick:z,children:"Save Changes"})]})]})})]})}export{ye as default};
