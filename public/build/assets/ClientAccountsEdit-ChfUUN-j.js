import{j as e,r as v,b as w}from"./app-C9fBnuOE.js";import{S as se,A as re,a as ae,b as te,B as ie,c as le,d as b,e as C,f as R}from"./breadcrumb-DJSYhXrx.js";import{S as x}from"./separator-qcrg4dPm.js";import{B as f}from"./button-B_fIfnBb.js";import{I as i}from"./input-qWEfNBQH.js";import ne from"./ClientAddresses-BD0pHq41.js";import{L as t}from"./label-DXs1eXQv.js";import{S as _,a as S,b as P,c as A,d as u}from"./select-Dl6e1rl2.js";import{S as ce}from"./switch-CkKYchMF.js";import{A as $,a as M,b as V,c as q,d as J,e as O,f as H,g as U,h as z}from"./alert-dialog-0S9w3esk.js";import{t as n}from"./index-BFwC0R9V.js";import oe from"./ClientJobs-DIOig-cu.js";import de from"./ClientSubClients-mhGFYrj9.js";import{A as me}from"./arrow-left-CHlG9NJT.js";import{S as he}from"./save-DVPj3KRl.js";import{T as xe}from"./trash-2-nXxqySza.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-JjatSUmS.js";import"./createLucideIcon-D4c-ObJW.js";import"./index-Dfe5dhDQ.js";import"./index-CNTKN5Ut.js";import"./index-DUsJq6sw.js";import"./index-CsWbMgBq.js";import"./index-Ds3v4yF_.js";import"./index-CWtl1gFV.js";import"./index-B-UXHqoX.js";import"./index-CoIQ1zsl.js";import"./calendar-WOkk4oO4.js";import"./data-table-DPOo7FHn.js";import"./table-DZdrIWYD.js";import"./columns-DXhuHmbw.js";import"./dialog-CjVGXQRN.js";import"./square-pen-TNSEbh-R.js";import"./data-table-HmwftU47.js";import"./columns-qxMdChRx.js";import"./badge-BZp_ungW.js";import"./arrow-up-down-D2rOcEQ4.js";import"./user-BC2GcKWG.js";import"./eye-BTD1d7_4.js";import"./data-table-B2-vr8j5.js";import"./columns-D3uw06Wz.js";function rs({user_edit:l,client_details:c,customer_types:F,industries:D,lead_sources:G}){if(!l||!c||!F||!D)return e.jsx("div",{children:"Loading..."});const[r,g]=v.useState({name:l.name||"",email:l.email||"",position:c.contact_position||"",landline:l.landline||"",mobile:l.mobile||"",active:l.active||!1,type:"client",address:c.address||"",address_2:c.address_2||"",town_city:c.town_city||"",county:c.county||"",postcode:c.postcode||"",contact_name:c.contact_name||"",sic_code:c.sic_code||"",customer_notes:c.customer_notes||"",customer_type_id:String(c.customer_type_id)||"",industry_id:String(c.industry_id)||"",lead_source_id:String(c.lead_source_id)||""}),[j,y]=v.useState({newPassword:"",confirmPassword:""}),[N,E]=v.useState({name:"",email:""}),[I,L]=v.useState(!1),T=()=>E({name:"",email:""}),o=s=>{const{name:a,value:d}=s.target;g(m=>({...m,[a]:d})),T()},K=s=>{g(a=>({...a,active:s}))},Q=async s=>{var a,d,m,p,B;s.preventDefault(),T();try{L(!0);const h={...r,type:"Client",position:r.position||null,customer_type_id:r.customer_type_id==="null"?null:r.customer_type_id,industry_id:r.industry_id==="null"?null:r.industry_id,lead_source_id:r.lead_source_id==="null"?null:r.lead_source_id,active:!!r.active};console.log("Sending payload:",h),(await w.put(`/customers/update/${l.id}`,h)).status===200&&(n.success("Client successfully updated!"),window.location.reload())}catch(h){if(console.error("Update error:",(a=h.response)==null?void 0:a.data),(m=(d=h.response)==null?void 0:d.data)!=null&&m.errors){const k=h.response.data.errors;Object.entries(k).forEach(([Z,ee])=>{n.error(`${Z}: ${ee}`)}),E(h.response.data.errors)}else(B=(p=h.response)==null?void 0:p.data)!=null&&B.message?n.error(h.response.data.message):n.error("An error occurred while updating the client.")}finally{L(!1)}},W=async()=>{var s,a,d,m;try{(await w.delete(`/customers/delete/${l.id}`)).status===200&&(n.success("Client account successfully deleted!"),window.location.href="/customers")}catch(p){(a=(s=p.response)==null?void 0:s.data)!=null&&a.hasJobs?n.error(p.response.data.message):n.error(((m=(d=p.response)==null?void 0:d.data)==null?void 0:m.message)||"An error occurred while deleting the account.")}},X=async()=>{try{(await w.post(`/customers/${l.id}/send-reset-email`)).status===200?n.success("Password reset email sent successfully."):n.error("Failed to send password reset email.")}catch{n.error("An error occurred while sending the password reset email.")}},Y=async()=>{var s,a;if(j.newPassword!==j.confirmPassword){n.error("Passwords do not match.");return}try{await w.post(`/customers/${l.id}/reset-password`,{password:j.newPassword,password_confirmation:j.confirmPassword}),n.success("Password reset successfully."),y({newPassword:"",confirmPassword:""})}catch(d){(a=(s=d.response)==null?void 0:s.data)!=null&&a.errors?Object.values(d.response.data.errors).forEach(m=>{n.error(m[0])}):n.error("An error occurred while resetting the password.")}};return e.jsxs(se,{children:[e.jsx(re,{}),e.jsxs(ae,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(te,{className:"-ml-1"}),e.jsx(x,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(ie,{children:e.jsxs(le,{children:[e.jsx(b,{children:e.jsx(C,{href:"/",children:"Dashboard"})}),e.jsx(R,{}),e.jsx(b,{children:e.jsx(C,{href:"/customers",children:"Customers"})}),e.jsx(R,{}),e.jsx(b,{children:e.jsx(C,{href:"#",children:"Edit Customer"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-3xl font-semibold text-gray-800",children:"Settings: Edit Customer Account"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{variant:"outline",onClick:()=>window.location.href=`/customers/${l.id}`,children:[e.jsx(me,{className:"h-6 w-6 mr-0"}),"Done Editing"]}),e.jsx(f,{className:"bg-green-500 text-white hover:bg-green-600 focus:ring-2 focus:ring-green-400",onClick:Q,disabled:I,children:I?e.jsx("span",{children:"Saving..."}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-5 w-5"}),"Save Changes"]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-6 p-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:["Customer Details",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Account Status:"}),e.jsx("span",{className:`text-sm px-4 py-1 rounded-sm ${r.active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"} font-medium`,children:r.active?"Active":"Disabled"})]})]}),e.jsx(x,{className:"my-4"}),e.jsxs("div",{className:"grid gap-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"name",className:"text-left",children:"Company Name*"}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{id:"name",name:"name",value:r.name,onChange:o,required:!0}),N.name&&e.jsx("p",{className:"text-red-600 text-sm",children:N.name})]})]}),e.jsx(x,{}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"address",className:"text-left",children:"Address Line 1"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"address",name:"address",value:r.address,onChange:o})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"address_2",className:"text-left",children:"Address Line 2"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"address_2",name:"address_2",value:r.address_2,onChange:o})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"town_city",className:"text-left",children:"Town/City"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"town_city",name:"town_city",value:r.town_city,onChange:o})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"county",className:"text-left",children:"County"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"county",name:"county",value:r.county,onChange:o})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"postcode",className:"text-left",children:"Postcode"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"postcode",name:"postcode",value:r.postcode,onChange:o})})]}),e.jsx(x,{}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"contact_name",className:"text-left",children:"Contact Name"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"contact_name",name:"contact_name",value:r.contact_name,onChange:o})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"position",className:"text-left",children:"Position"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"position",name:"position",value:r.position,onChange:o})})]}),e.jsx(x,{}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"landline",className:"text-left",children:"Landline"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"landline",name:"landline",value:r.landline,onChange:o})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"mobile",className:"text-left",children:"Mobile"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"mobile",name:"mobile",value:r.mobile,onChange:o})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"email",className:"text-left",children:"Email*"}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{id:"email",name:"email",type:"email",value:r.email,onChange:o,required:!0}),N.email&&e.jsx("p",{className:"text-red-600 text-sm",children:N.email})]})]})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"More Details"}),e.jsx(x,{}),e.jsxs("div",{className:"grid gap-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"lead_source_id",className:"text-left",children:"Lead Source"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(_,{onValueChange:s=>g(a=>({...a,lead_source_id:s==="null"?"":s})),value:r.lead_source_id||"null",children:[e.jsx(S,{className:"w-full",children:e.jsx(P,{placeholder:"Select Lead Source"})}),e.jsxs(A,{children:[e.jsx(u,{value:"null",children:"None"}),G.map(s=>e.jsx(u,{value:String(s.id),children:s.ls_name},s.id))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"customer_type_id",className:"text-left",children:"Customer Type"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(_,{onValueChange:s=>g(a=>({...a,customer_type_id:s==="null"?"":s})),value:r.customer_type_id||"null",children:[e.jsx(S,{className:"w-full",children:e.jsx(P,{placeholder:"Select Customer Type"})}),e.jsxs(A,{children:[e.jsx(u,{value:"null",children:"None"}),F.map(s=>e.jsx(u,{value:String(s.id),children:s.ct_name},s.id))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"industry_id",className:"text-left",children:"Industry"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(_,{onValueChange:s=>g(a=>({...a,industry_id:s==="null"?"":s})),value:r.industry_id||"null",children:[e.jsx(S,{className:"w-full",children:e.jsx(P,{placeholder:"Select Industry"})}),e.jsxs(A,{children:[e.jsx(u,{value:"null",children:"None"}),D.map(s=>e.jsx(u,{value:String(s.id),children:s.in_name},s.id))]})]})})]}),e.jsx(x,{}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"sic_code",className:"text-left",children:"SIC Code"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"sic_code",name:"sic_code",value:r.sic_code,onChange:o})})]}),e.jsx(x,{}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(t,{htmlFor:"customer_notes",className:"text-left",children:"Customer Notes"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{id:"customer_notes",name:"customer_notes",value:r.customer_notes,onChange:o})})]})]})]})]}),e.jsxs("section",{children:[e.jsx(oe,{parentId:l.id}),e.jsx("div",{className:"mt-6",children:e.jsx(ne,{parentId:l.id})}),e.jsx("div",{className:"mt-6",children:e.jsx(de,{parentId:l.id})})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Account Settings"}),e.jsx(x,{className:"mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h3",{className:"text-base font-medium",children:"Reset Password"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reset the client's password."}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(f,{variant:"outline",onClick:X,children:"Email Password Reset"}),e.jsxs($,{children:[e.jsx(M,{asChild:!0,children:e.jsx(f,{variant:"outline",children:"Manual Password Reset"})}),e.jsxs(V,{children:[e.jsxs(q,{children:[e.jsx(J,{children:"Manual Password Reset"}),e.jsx(O,{children:"Enter the new password below to manually reset the client's password."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"newPassword",children:"New Password"}),e.jsx(i,{id:"newPassword",name:"newPassword",type:"password",value:j.newPassword,onChange:s=>y(a=>({...a,newPassword:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(i,{id:"confirmPassword",name:"confirmPassword",type:"password",value:j.confirmPassword,onChange:s=>y(a=>({...a,confirmPassword:s.target.value}))})]})]}),e.jsxs(H,{children:[e.jsx(U,{children:"Cancel"}),e.jsx(z,{onClick:Y,children:"Save"})]})]})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h3",{className:"text-base font-medium",children:"Disable Account"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Disable this client account from being accessed."}),e.jsx(ce,{className:"mt-4",checked:!r.active,onCheckedChange:s=>K(!s)})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h3",{className:"text-base font-medium",children:"Delete Account"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Permanently remove this client account from the system."}),e.jsxs($,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(f,{variant:"destructive",className:"mt-4",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Delete Account"]})}),e.jsxs(V,{children:[e.jsxs(q,{children:[e.jsx(J,{children:"Confirm Deletion"}),e.jsx(O,{children:"Are you sure you want to delete this client account? This action cannot be undone."})]}),e.jsxs(H,{children:[e.jsx(U,{children:"Cancel"}),e.jsx(z,{onClick:W,children:"Confirm"})]})]})]})]})]})]})]})]})]})]})}export{rs as default};
