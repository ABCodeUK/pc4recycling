import{r as d,j as e,b as j}from"./app-CNWjOMNx.js";import{S as F}from"./separator-BPue9knr.js";import{DataTable as le}from"./data-table-CS4mL3vy.js";import{subClientColumns as ie}from"./columns-CGpuc818.js";import{I as o}from"./input-CKARXW-H.js";import{L as c}from"./label-EHUiVpis.js";import{t as l}from"./index-DROTMuiR.js";import{B as m}from"./button-Cif8vmUM.js";import{D as T,b as L,c as R,d as M,e as O,f as U}from"./dialog-BfgzRhkV.js";import{A as $,a as z,b as B,c as H,d as _,e as q,f as W,g as G,h as I}from"./alert-dialog-BBmyk8cd.js";import{S as ne}from"./switch-3WLVaHNX.js";import{S as te}from"./square-pen-DthIdKap.js";import{T as oe}from"./trash-2-UOQr6mTH.js";import"./index-BHpFse_T.js";import"./index-DUDCROMg.js";import"./utils-CytzSlOG.js";import"./table-B5rCecqS.js";import"./select-DyBRev3z.js";import"./index-D-4-NTWd.js";import"./index-CmDO7QdU.js";import"./index-DPKFiV9N.js";import"./index-CNsmnkFI.js";import"./createLucideIcon-ClQ1hqbp.js";import"./index-BqYSSVB3.js";import"./index-CnljWFNF.js";import"./index-BflIAMo0.js";import"./badge-BpDmfbip.js";import"./index-BwobEAja.js";import"./index-BJMVI5o3.js";function ze({parentId:w}){const[J,g]=d.useState([]),[A,ce]=d.useState(""),[K,v]=d.useState(!1),[Q,C]=d.useState(!1),[b,E]=d.useState({name:"",email:"",landline:"",mobile:""}),[h,p]=d.useState({name:"",email:"",active:""}),D=()=>{p({name:"",email:"",active:""})},k=()=>{E({name:"",email:"",landline:"",mobile:""}),D()},[a,y]=d.useState(null);d.useEffect(()=>{w&&(async()=>{try{console.log("Fetching sub-clients for parent:",w);const r=await j.get(`/customers/${w}/sub-clients`);console.log("Sub-clients response:",r.data),g(r.data)}catch(r){console.error("Error fetching sub-clients:",r),l.error("Failed to fetch sub-clients.")}})()},[w]);const u=(s,r)=>{const{name:i,value:n}=s.target;r==="add"?E(t=>({...t,[i]:n})):a&&y(t=>t?{...t,[i]:n}:null),p(t=>({...t,[i]:""}))},V=async()=>{var s;try{const r=await j.post("/sub-clients",{...b,parent_id:w});g(i=>[...i,r.data]),l.success("Sub-client successfully added!"),v(!1),k()}catch(r){l.error("Failed to add sub-client."),p(((s=r.response)==null?void 0:s.data.errors)||{})}},X=async()=>{var s;if(a){D();try{const r=await j.put(`/sub-clients/${a.id}`,a);g(i=>i.map(n=>n.id===a.id?r.data:n)),C(!1),l.success("Sub-client successfully updated!")}catch(r){(s=r.response)!=null&&s.data.errors?p(r.response.data.errors):l.error("Failed to update sub-client.")}}},[f,S]=d.useState({newPassword:"",confirmPassword:""}),Y=async s=>{try{(await j.post(`/customers/${s}/send-reset-email`)).status===200?l.success("Password reset email sent successfully."):l.error("Failed to send password reset email.")}catch{l.error("An error occurred while sending the password reset email.")}},Z=async s=>{var r,i;if(f.newPassword!==f.confirmPassword){l.error("Passwords do not match.");return}try{await j.post(`/customers/${s}/reset-password`,{password:f.newPassword,password_confirmation:f.confirmPassword}),l.success("Password reset successfully."),S({newPassword:"",confirmPassword:""})}catch(n){(i=(r=n.response)==null?void 0:r.data)!=null&&i.errors?Object.values(n.response.data.errors).forEach(t=>{l.error(t[0])}):l.error("An error occurred while resetting the password.")}},ee=async(s,r)=>{var i,n,t;try{const N=await j.put(`/sub-clients/${s}`,{...a,active:!r});g(x=>x.map(P=>P.id===s?{...P,active:!r}:P)),y(x=>x?{...x,active:!r}:null),l.success("Account status updated successfully!"),p(x=>({...x,active:""}))}catch(N){(t=(n=(i=N.response)==null?void 0:i.data)==null?void 0:n.errors)!=null&&t.active&&p(x=>({...x,active:N.response.data.errors.active[0]})),l.error("Failed to update account status.")}},se=async s=>{try{await j.delete(`/sub-clients/${s}`),g(r=>r.filter(i=>i.id!==s)),l.success("Sub-User successfully deleted!")}catch{l.error("Failed to delete sub-User.")}},ae=J.filter(s=>s.name.toLowerCase().includes(A.toLowerCase())||s.email.toLowerCase().includes(A.toLowerCase())),re=[...ie,{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"Actions"}),cell:({row:s})=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{y(s.original),C(!0)},children:e.jsx(te,{className:"h-4 w-4"})}),e.jsxs($,{children:[e.jsx(z,{asChild:!0,children:e.jsx(m,{variant:"destructive",size:"sm",children:e.jsx(oe,{className:"h-4 w-4"})})}),e.jsxs(B,{children:[e.jsxs(H,{children:[e.jsx(_,{children:"Confirm Deletion"}),e.jsxs(q,{children:["Are you sure you want to delete ",e.jsx("b",{children:s.original.name}),"?"]})]}),e.jsxs(W,{children:[e.jsx(G,{children:"Cancel"}),e.jsx(I,{onClick:()=>se(s.original.id),children:"Delete"})]})]})]})]})}];return e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Sub-Users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add, edit, or delete sub-user for this customer."})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(m,{onClick:()=>v(!0),children:"Add Sub-Users"})})]}),e.jsx(F,{className:"my-4"}),e.jsx(le,{columns:re,data:ae}),e.jsx(T,{open:K,onOpenChange:s=>{s||k(),v(s)},children:e.jsxs(L,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(R,{children:[e.jsx(M,{children:"Add Sub-Users"}),e.jsx(O,{children:"Fill in the details for the new sub-user below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",name:"name",value:b.name,onChange:s=>u(s,"add")}),h.name&&e.jsx("p",{className:"text-red-600 text-sm",children:h.name})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",value:b.email,onChange:s=>u(s,"add")}),h.email&&e.jsx("p",{className:"text-red-600 text-sm",children:h.email})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"landline",children:"Landline"}),e.jsx(o,{id:"landline",name:"landline",value:b.landline,onChange:s=>u(s,"add")})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"mobile",children:"Mobile"}),e.jsx(o,{id:"mobile",name:"mobile",value:b.mobile,onChange:s=>u(s,"add")})]})]})}),e.jsxs(U,{children:[e.jsx(m,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(m,{onClick:V,children:"Add Sub-Client"})]})]})}),e.jsx(T,{open:Q,onOpenChange:s=>C(s),children:e.jsxs(L,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(R,{children:[e.jsx(M,{children:"Edit Sub-Client"}),e.jsx(O,{children:"Update the details for the sub-client below."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",name:"name",value:(a==null?void 0:a.name)||"",onChange:s=>u(s,"edit")}),h.name&&e.jsx("p",{className:"text-red-600 text-sm",children:h.name})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",value:(a==null?void 0:a.email)||"",onChange:s=>u(s,"edit")}),h.email&&e.jsx("p",{className:"text-red-600 text-sm",children:h.email})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"landline",children:"Landline"}),e.jsx(o,{id:"landline",name:"landline",value:(a==null?void 0:a.landline)||"",onChange:s=>u(s,"edit")})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"mobile",children:"Mobile"}),e.jsx(o,{id:"mobile",name:"mobile",value:(a==null?void 0:a.mobile)||"",onChange:s=>u(s,"edit")})]})]}),e.jsx(F,{className:"my-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-medium",children:"Reset Password"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>Y((a==null?void 0:a.id)||0),children:"Email Password Reset"}),e.jsxs($,{children:[e.jsx(z,{asChild:!0,children:e.jsx(m,{variant:"outline",children:"Manual Password Reset"})}),e.jsxs(B,{children:[e.jsxs(H,{children:[e.jsx(_,{children:"Manual Password Reset"}),e.jsx(q,{children:"Enter the new password below to manually reset the sub-client's password."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"newPassword",children:"New Password"}),e.jsx(o,{id:"newPassword",name:"newPassword",type:"password",value:f.newPassword,onChange:s=>S(r=>({...r,newPassword:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(o,{id:"confirmPassword",name:"confirmPassword",type:"password",value:f.confirmPassword,onChange:s=>S(r=>({...r,confirmPassword:s.target.value}))})]})]}),e.jsxs(W,{children:[e.jsx(G,{children:"Cancel"}),e.jsx(I,{onClick:()=>Z((a==null?void 0:a.id)||0),children:"Save"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-medium",children:"Account Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{checked:(a==null?void 0:a.active)||!1,onCheckedChange:s=>ee((a==null?void 0:a.id)||0,(a==null?void 0:a.active)||!1)}),e.jsx("span",{children:a!=null&&a.active?"Active":"Disabled"})]})]}),e.jsxs(U,{children:[e.jsx(m,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(m,{onClick:X,children:"Save Changes"})]})]})})]})}export{ze as default};
