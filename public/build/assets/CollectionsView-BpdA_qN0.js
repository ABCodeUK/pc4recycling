import{r as b,j as e,b as I,h as T}from"./app-Bu3c7SRr.js";import{S as P,A as q,a as H,b as J,B as R,c as C,d as w,e as D,f as S,R as d}from"./breadcrumb-Bi7r5ojT.js";import{S as c}from"./separator-DeG03c2e.js";import{B as n}from"./button-Bugdv60n.js";import{I as N}from"./input-BVpfwKRE.js";import{t as f}from"./index-3t_yQiYB.js";import O from"./JobItems-ckCtxO3p.js";import U from"./JobAuditLog-BRV45dSa.js";import{c as A}from"./createLucideIcon-Bz1iimCp.js";import{A as z}from"./arrow-left-BYdBmsyY.js";import{S as V}from"./square-pen-DXuvlyv5.js";import{T as _}from"./trash-2-DrUuMYvl.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-ChGmrCfR.js";import"./index-SS-33b3l.js";import"./index-DFqYG-k0.js";import"./index-BUVUn23p.js";import"./index-_W5zKMP9.js";import"./index-C7O5j1LF.js";import"./index-DwKaao6N.js";import"./index-s5S9bHjZ.js";import"./index-CAO6zNd6.js";import"./calendar-BRWOvoKA.js";import"./tabs-B7qZ_r0x.js";import"./data-table-DHU9EvYG.js";import"./table-CKhMPQAp.js";import"./columns-D2hnt_7p.js";import"./select-DIgAzQ0l.js";import"./CollectionSignatureDialog-R-8iDJWX.js";import"./extends-CF3RwP-h.js";import"./dialog-ggMMgphc.js";import"./badge-BsNgKg_w.js";import"./pencil-CahwZH8F.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=A("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=A("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function Se({job:a,customers:M,documents:E}){b.useState(!1);const[i,g]=b.useState(E||{collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:[]}),[h,k]=b.useState({collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:null}),p=async t=>{const m=h[t];if(!m)return;const r=new FormData;r.append("document",m),r.append("document_type",t);try{const o=await I.post(`/collections/${a.id}/documents`,r,{headers:{"Content-Type":"multipart/form-data"}});o.data&&(g(t==="other"?x=>({...x,other:[...x.other,o.data.document]}):x=>({...x,[t]:o.data.document})),k(x=>({...x,[t]:null})),f.success("Document uploaded successfully"))}catch(o){console.error("Upload error:",o),f.error("Failed to upload document")}},u=(t,m)=>{var o;const r=(o=t.target.files)==null?void 0:o[0];if(r){if(r.size>134217728){f.error("File size must be less than 128MB"),t.target.value="";return}k(B=>({...B,[m]:r}))}};n,h.collection_manifest;const v=(t,m)=>{T.delete(`/collections/${a.id}/documents/${t}`,{preserveScroll:!0,onSuccess:()=>{g(m==="other"?r=>({...r,other:r.other.filter(o=>o.id!==t)}):r=>({...r,[m]:null})),f.success("Document deleted successfully")},onError:()=>{f.error("Failed to delete document")}})},l=({label:t,value:m})=>e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:t}),e.jsx("dd",{className:"text-sm text-gray-900 text-left",children:m||"-"})]}),$=t=>t==="Active"?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",L=t=>{switch(t){case"Scheduled":return"bg-green-100 text-green-800 border-green-200";case"Postponed":case"Cancelled":return"bg-red-100 text-red-800 border-red-200";case"Collected":case"Processing":case"Complete":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},s=M.find(t=>t.id===a.client_id),F=a.collection_date?new Date(a.collection_date).toLocaleDateString():"-";return e.jsxs(P,{children:[e.jsx(q,{}),e.jsxs(H,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(J,{className:"-ml-1"}),e.jsx(c,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(R,{children:e.jsxs(C,{children:[e.jsx(w,{children:e.jsx(D,{href:"/dashboard",children:"Dashboard"})}),e.jsx(S,{}),e.jsxs(d,{role:"Developer|Administrator|Employee|Manager|Director",children:[e.jsx(w,{children:e.jsx(D,{href:"/collections",children:"Collections"})}),e.jsx(S,{})]}),e.jsx(w,{children:e.jsx(D,{href:"#",children:"View Job"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"text-3xl font-semibold text-gray-800",children:["Collection: ",a.job_id]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsxs(n,{variant:"outline",onClick:()=>window.location.href="/collections",children:[e.jsx(z,{className:"h-6 w-6"}),"Back to Collections"]})}),e.jsx(d,{role:"Drivers",children:e.jsxs(n,{variant:"outline",onClick:()=>window.location.href="/dashboard",children:[e.jsx(z,{className:"h-6 w-6"}),"Back to Dashboard"]})}),e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsxs(n,{onClick:()=>window.location.href=`/collections/${a.id}/edit`,children:[e.jsx(V,{className:"h-6 w-6"}),"Edit Job"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:["Collection Details",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${L(a.job_status)}`,children:a.job_status})]})]}),e.jsx(c,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(l,{label:"Job Number",value:a.job_id}),e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Customer"}),e.jsxs("dd",{className:"text-sm text-left",children:[e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx("a",{href:`/customers/${s==null?void 0:s.id}`,className:"text-primary hover:text-primary/90",children:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"})}),e.jsx(d,{role:"Drivers",children:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"})]})]}),e.jsx(l,{label:"Collection Date",value:F}),e.jsx(c,{className:"my-2"}),e.jsx(l,{label:"Staff Collecting",value:a.staff_collecting||"-"}),e.jsx(l,{label:"Vehicle",value:a.vehicle||"-"}),e.jsx(c,{className:"my-2"}),e.jsx(l,{label:"Address Line 1",value:a.address}),e.jsx(l,{label:"Address Line 2",value:a.address_2}),e.jsx(l,{label:"Town/City",value:a.town_city}),e.jsx(l,{label:"Postcode",value:a.postcode}),e.jsx(c,{className:"my-2"}),e.jsx(l,{label:"Onsite Contact",value:a.onsite_contact||"-"}),e.jsx(l,{label:"Onsite Number",value:a.onsite_number||"-"}),e.jsx(l,{label:"Onsite Email",value:a.onsite_email||"-"})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"More Information"}),e.jsx(c,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(l,{label:"Collection Type",value:a.collection_type||"-"}),e.jsx(l,{label:"Data Sanitisation",value:a.data_sanitisation||"-"}),e.jsx(l,{label:"Service Level Agreement",value:a.sla||"-"}),e.jsx(c,{className:"my-2"}),e.jsx(l,{label:"Equipment Location",value:a.equipment_location||"-"}),e.jsx(l,{label:"Building Access",value:a.building_access||"-"}),e.jsx(l,{label:"Collection Route",value:a.collection_route||"-"}),e.jsx(l,{label:"Parking & Loading",value:a.parking_loading||"-"}),e.jsx(l,{label:"Equipment Readiness",value:a.equipment_readiness||"-"}),e.jsx(c,{className:"my-2"}),e.jsxs("div",{className:"py-1",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Other Information"}),e.jsx("dd",{className:"mt-2 text-sm text-gray-900",children:a.instructions||"No instructions provided."})]})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:["Customer Details",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Account:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${$(s==null?void 0:s.account_status)}`,children:(s==null?void 0:s.account_status)||"Disabled"})]})]}),e.jsx(c,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(l,{label:"Company Name",value:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"}),e.jsx(l,{label:"Address Line 1",value:(s==null?void 0:s.address)||"-"}),e.jsx(l,{label:"Address Line 2",value:(s==null?void 0:s.address_2)||"-"}),e.jsx(l,{label:"Town/City",value:(s==null?void 0:s.town_city)||"-"}),e.jsx(l,{label:"County",value:(s==null?void 0:s.county)||"-"}),e.jsx(l,{label:"Postcode",value:(s==null?void 0:s.postcode)||"-"}),e.jsx(c,{className:"my-2"}),e.jsx(l,{label:"Contact Name",value:(s==null?void 0:s.contact_name)||"-"}),e.jsx(l,{label:"Position",value:(s==null?void 0:s.position)||"-"}),e.jsx(l,{label:"Landline",value:(s==null?void 0:s.landline)||"-"}),e.jsx(l,{label:"Mobile",value:(s==null?void 0:s.mobile)||"-"}),e.jsx(l,{label:"Email",value:(s==null?void 0:s.email)||"-"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Job Documents"})}),e.jsx(d,{role:"Drivers",children:e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Collection Images"})}),e.jsx(c,{className:"my-4"}),e.jsx("div",{className:"space-y-6",children:e.jsxs(d,{role:"Developer|Administrator|Employee|Manager|Director",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Collection Manifest"}),e.jsx("div",{className:"flex gap-2 items-center",children:i.collection_manifest?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${a.id}/${i.collection_manifest.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),i.collection_manifest.original_filename]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>i.collection_manifest&&v(i.collection_manifest.id,"collection_manifest"),children:e.jsx(_,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(N,{type:"file",accept:".pdf",onChange:t=>u(t,"collection_manifest")}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>p("collection_manifest"),disabled:!h.collection_manifest,children:e.jsx(j,{className:"h-4 w-4"})})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Hazard Waste Note"}),e.jsx("div",{className:"flex gap-2 items-center",children:i.hazard_waste_note?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${a.id}/${i.hazard_waste_note.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),i.hazard_waste_note.original_filename]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>i.hazard_waste_note&&v(i.hazard_waste_note.id,"hazard_waste_note"),children:e.jsx(_,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(N,{type:"file",accept:".pdf",onChange:t=>u(t,"hazard_waste_note")}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>p("hazard_waste_note"),disabled:!h.hazard_waste_note,children:e.jsx(j,{className:"h-4 w-4"})})]})})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Data Destruction Certificate"}),e.jsx("div",{className:"flex gap-2 items-center",children:i.data_destruction_certificate?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${a.id}/${i.data_destruction_certificate.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),i.data_destruction_certificate.original_filename]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>i.data_destruction_certificate&&v(i.data_destruction_certificate.id,"data_destruction_certificate"),children:e.jsx(_,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(N,{type:"file",accept:".pdf",onChange:t=>u(t,"data_destruction_certificate")}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>p("data_destruction_certificate"),disabled:!h.data_destruction_certificate,children:e.jsx(j,{className:"h-4 w-4"})})]})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Other Documents"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(N,{type:"file",accept:".pdf",onChange:t=>u(t,"other")}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>p("other"),disabled:!h.other,children:e.jsx(j,{className:"h-4 w-4"})})]}),i.other.length>0&&e.jsx("div",{className:"space-y-2",children:i.other.map(t=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("a",{href:`/documents/${a.id}/${t.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),t.original_filename]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>v(t.id,"other"),children:e.jsx(_,{className:"h-4 w-4 text-red-500"})})]},t.id))})]})]})]})})]}),e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx(U,{jobId:a.id})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("section",{children:e.jsx(O,{jobId:a.job_id,jobStatus:a.job_status})})})]})]})]})}export{Se as default};
