import{r,j as e,b as m}from"./app-BB65Mc1n.js";import{S as I}from"./separator-BWJbAkR8.js";import{DataTable as A}from"./data-table-BIVPdGcl.js";import{clientJobColumns as E}from"./columns-BCkweutH.js";import{I as h}from"./input-BdsrUm4j.js";import{L as j}from"./label-B29Fbpt8.js";import{D as L,a as T,b as O,c as V,d as k,e as B,f as $}from"./dialog-44kL--cs.js";import{S as H,a as M,b as P,c as R,d as q}from"./select-Dp5Udnaz.js";import{t as n}from"./index-BD8g9cTJ.js";import{B as b}from"./button-AMd0rht4.js";import"./index-C6WAMNeG.js";import"./index-BD0Aflgb.js";import"./utils-CytzSlOG.js";import"./table-Baebw86p.js";import"./badge-BdYjlQZJ.js";import"./index-BwobEAja.js";import"./arrow-up-down-BGwv5Hje.js";import"./createLucideIcon-DhOTYlCm.js";import"./user-CkqYK0Er.js";import"./eye-zEeA36q9.js";import"./index-DJRbUwlk.js";import"./index-CwOflKzf.js";import"./index-Bax49BpN.js";import"./index-DwCxHBl2.js";import"./index-d89-VRCp.js";import"./index-C6DuYNlM.js";import"./index--1ygw0mz.js";import"./index-DbDOfuCE.js";function Se({parentId:l}){const[p,_]=r.useState([]),[c,C]=r.useState(""),[w,x]=r.useState(!1),[u,D]=r.useState(""),[f,g]=r.useState(!1),[z,v]=r.useState({}),N=["Needs Scheduling","Scheduled","Postponed"],[i,d]=r.useState({job_id:"",collection_date:"",job_status:"Needs Scheduling"});r.useEffect(()=>{const t=async()=>{try{const s=await m.get(`/customers/${l}/jobs`);console.log("Fetched jobs:",s.data),_(s.data.jobs||s.data)}catch(s){console.error("Error fetching jobs:",s),n.error("Failed to fetch jobs.")}},o=async()=>{try{const s=await m.get("/collections/next-job-id");D(s.data.next_job_id),d(a=>({...a,job_id:s.data.next_job_id}))}catch(s){console.error("Failed to fetch next job ID:",s)}};l&&(t(),o())},[l]);const S=t=>{const{name:o,value:s}=t.target;d(a=>({...a,[o]:s}))},y=t=>{d(o=>({...o,job_status:t}))},J=async()=>{var t,o;try{g(!0);const s={job_id:i.job_id||u,client_id:l,job_status:i.job_status,collection_date:i.collection_date||null},a=await m.post("/collections",s);a.data&&(n.success("Job created successfully!"),window.location.href=`/collections/${a.data.id}/edit`)}catch(s){(o=(t=s.response)==null?void 0:t.data)!=null&&o.errors?(v(s.response.data.errors),Object.values(s.response.data.errors).forEach(a=>{n.error(a[0])})):n.error("Failed to create job.")}finally{g(!1)}},F=Array.isArray(p)?p.filter(t=>t.job_id.toLowerCase().includes(c.toLowerCase())||t.address&&t.address.toLowerCase().includes(c.toLowerCase())):[];return e.jsxs("section",{className:"bg-white border shadow rounded-lg",children:[e.jsx("header",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Manage Jobs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View and manage all jobs for this customer."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{placeholder:"Search Jobs...",value:c,onChange:t=>C(t.target.value),className:"max-w-sm"}),e.jsxs(L,{open:w,onOpenChange:x,children:[e.jsx(T,{asChild:!0,children:e.jsx(b,{children:"Add New Job"})}),e.jsxs(O,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(V,{children:[e.jsx(k,{children:"Create New Job"}),e.jsx(B,{children:"Fill in the details for the new job below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"job_id",children:"Job ID"}),e.jsx(h,{id:"job_id",name:"job_id",value:i.job_id||u,onChange:S})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"collection_date",children:"Collection Date (Optional)"}),e.jsx(h,{id:"collection_date",name:"collection_date",type:"date",value:i.collection_date,onChange:S})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"job_status",children:"Status"}),e.jsxs(H,{value:i.job_status,onValueChange:y,children:[e.jsx(M,{children:e.jsx(P,{placeholder:"Select status"})}),e.jsx(R,{children:N.map(t=>e.jsx(q,{value:t,children:t},t))})]})]})]})}),e.jsxs($,{children:[e.jsx(b,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(b,{onClick:J,disabled:f,children:f?"Creating...":"Create Job"})]})]})]})]})]})}),e.jsx(I,{}),e.jsx("div",{className:"p-6",children:e.jsx(A,{columns:E,data:F})})]})}export{Se as default};
