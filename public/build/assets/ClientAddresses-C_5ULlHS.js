import{r as i,j as e,b as j}from"./app-CxxjQbGd.js";import{S as U}from"./separator-OWjsBv_k.js";import{B as h}from"./button-BfCUFj2v.js";import{I as c}from"./input-DPP4pqCX.js";import{L as l}from"./label-2wttpgDy.js";import{DataTable as W}from"./data-table-DyHF-acO.js";import{userAddressColumns as G}from"./columns-C__I2ANo.js";import{t as x}from"./index-CGbDflUn.js";import{D as _,b as S,c as b,d as F,e as E,f as T}from"./dialog-0RdKrRPh.js";import{A as I,a as J,b as K,c as Q,d as V,e as X,f as Y,g as Z,h as ee}from"./alert-dialog-IHHWyKpT.js";import{S as se}from"./square-pen-DlkBvHz6.js";import{T as te}from"./trash-2-BuUhqBcA.js";import"./index-Drt13xjj.js";import"./index-DdQz_MXT.js";import"./index-B6zYnIfL.js";import"./utils-CytzSlOG.js";import"./index-BwobEAja.js";import"./table-B3GsT3Yk.js";import"./select-CnJHFvlZ.js";import"./index-CpwjmW8Z.js";import"./Combination-DnQhWoyI.js";import"./createLucideIcon-YMZQpf5O.js";import"./index-uXkLkjFM.js";import"./index-Dy7fGhxC.js";function be({parentId:m}){const[k,f]=i.useState([]),[w,R]=i.useState(null),[p,C]=i.useState({address:"",town_city:"",county:"",postcode:""}),[t,v]=i.useState(null),[d,y]=i.useState({address:"",town_city:"",county:"",postcode:""}),[O,de]=i.useState(""),[L,g]=i.useState(!1),[$,A]=i.useState(!1);i.useEffect(()=>{m&&(async()=>{try{const o=(await j.get(`/addresses/${m}`)).data,a=(await j.get(`/customers/${m}/default-address`)).data;if(a){const M={id:-1,address:a.address||"",town_city:a.town_city||"",county:a.county||"",postcode:a.postcode||"",user_id:m};R(M)}f(o)}catch{x.error("Failed to fetch addresses.")}})()},[m]);const D=()=>y({address:"",town_city:"",county:"",postcode:""}),N=()=>{C({address:"",town_city:"",county:"",postcode:""}),D()},n=(s,r)=>{const{name:o,value:u}=s.target;r==="add"?C(a=>({...a,[o]:u})):t&&v(a=>a?{...a,[o]:u}:null),y(a=>({...a,[o]:""}))},P=async()=>{var s;try{const r=await j.post("/addresses",{...p,parent_id:m});f(o=>[...o,r.data]),x.success("Address successfully added!"),g(!1),N()}catch(r){x.error("Failed to add address."),y(((s=r.response)==null?void 0:s.data.errors)||{})}},z=async()=>{var s;if(t){D();try{const r=await j.put(`/addresses/${t.id}`,t);f(o=>o.map(u=>u.id===t.id?r.data:u)),A(!1),x.success("Address successfully updated!")}catch(r){(s=r.response)!=null&&s.data.errors?y(r.response.data.errors):x.error("Failed to update address.")}}},B=async s=>{try{await j.delete(`/addresses/${s}`),f(r=>r.filter(o=>o.id!==s)),x.success("Address successfully deleted!")}catch{x.error("Failed to delete address.")}},H=[...w?[w]:[],...k.filter(s=>s.address.toLowerCase().includes(O.toLowerCase()))],q=[...G,{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"Actions"}),cell:({row:s})=>s.original.id===-1?e.jsx("div",{className:"text-right text-muted-foreground",children:"(Default Address)"}):e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>{v(s.original),A(!0)},children:e.jsx(se,{className:"h-4 w-4"})}),e.jsxs(I,{children:[e.jsx(J,{asChild:!0,children:e.jsx(h,{variant:"destructive",size:"sm",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsxs(K,{children:[e.jsxs(Q,{children:[e.jsx(V,{children:"Confirm Deletion"}),e.jsx(X,{children:"Are you sure you want to delete this address?"})]}),e.jsxs(Y,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(ee,{onClick:()=>B(s.original.id),children:"Delete"})]})]})]})]})}];return e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Addresses"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add, edit, or delete addresses for this user."})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(h,{onClick:()=>g(!0),children:"Add Address"})})]}),e.jsx(U,{className:"my-4"}),e.jsx(W,{columns:q,data:H}),e.jsx(_,{open:L,onOpenChange:s=>{s||N(),g(s)},children:e.jsxs(S,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(b,{children:[e.jsx(F,{children:"Add Address"}),e.jsx(E,{children:"Fill in the details for the new address below."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"address",children:"Address"}),e.jsx(c,{id:"address",name:"address",value:p.address,onChange:s=>n(s,"add")}),d.address&&e.jsx("p",{className:"text-red-600 text-sm",children:d.address})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"town_city",children:"Town / City"}),e.jsx(c,{id:"town_city",name:"town_city",value:p.town_city,onChange:s=>n(s,"add")}),d.town_city&&e.jsx("p",{className:"text-red-600 text-sm",children:d.town_city})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"county",children:"County"}),e.jsx(c,{id:"county",name:"county",value:p.county,onChange:s=>n(s,"add")}),d.county&&e.jsx("p",{className:"text-red-600 text-sm",children:d.county})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"postcode",children:"Postcode"}),e.jsx(c,{id:"postcode",name:"postcode",value:p.postcode,onChange:s=>n(s,"add")}),d.postcode&&e.jsx("p",{className:"text-red-600 text-sm",children:d.postcode})]})]}),e.jsxs(T,{children:[e.jsx(h,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(h,{onClick:P,children:"Add Address"})]})]})}),e.jsx(_,{open:$,onOpenChange:s=>A(s),children:e.jsxs(S,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(b,{children:[e.jsx(F,{children:"Edit Address"}),e.jsx(E,{children:"Update the details for the address below."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"address",children:"Address"}),e.jsx(c,{id:"address",name:"address",value:(t==null?void 0:t.address)||"",onChange:s=>n(s,"edit")}),d.address&&e.jsx("p",{className:"text-red-600 text-sm",children:d.address})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"town_city",children:"Town / City"}),e.jsx(c,{id:"town_city",name:"town_city",value:(t==null?void 0:t.town_city)||"",onChange:s=>n(s,"edit")}),d.town_city&&e.jsx("p",{className:"text-red-600 text-sm",children:d.town_city})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"county",children:"County"}),e.jsx(c,{id:"county",name:"county",value:(t==null?void 0:t.county)||"",onChange:s=>n(s,"edit")}),d.county&&e.jsx("p",{className:"text-red-600 text-sm",children:d.county})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"postcode",children:"Postcode"}),e.jsx(c,{id:"postcode",name:"postcode",value:(t==null?void 0:t.postcode)||"",onChange:s=>n(s,"edit")}),d.postcode&&e.jsx("p",{className:"text-red-600 text-sm",children:d.postcode})]})]}),e.jsxs(T,{children:[e.jsx(h,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsx(h,{onClick:z,children:"Save Changes"})]})]})})]})}export{be as default};
