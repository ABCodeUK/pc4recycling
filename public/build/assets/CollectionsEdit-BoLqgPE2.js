import{r as f,j as e,h as T,b as z}from"./app-BB65Mc1n.js";import{S as K,A as Q,a as U,b as W,B as X,c as Y,d as b,e as N,f as P}from"./breadcrumb-D6RxqHid.js";import{S as m}from"./separator-BWJbAkR8.js";import{B as y}from"./button-AMd0rht4.js";import{I as d}from"./input-BdsrUm4j.js";import{L as n}from"./label-B29Fbpt8.js";import{S as x,a as p,b as j,c as u,d as o}from"./select-Dp5Udnaz.js";import{t as v}from"./index-BD8g9cTJ.js";import{A as Z,a as ee,b as se,c as ie,d as ne,e as ae,f as le,g as re,h as ce}from"./alert-dialog-BkxvyqSV.js";import{A as te}from"./arrow-left-Dk30N2JD.js";import{S as de}from"./save-DRu4wydO.js";import{T as oe}from"./trash-2-CyBVRyGm.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./dialog-44kL--cs.js";import"./index-DJRbUwlk.js";import"./index-CwOflKzf.js";import"./index-Bax49BpN.js";import"./index-C6WAMNeG.js";import"./index-BD0Aflgb.js";import"./index-DwCxHBl2.js";import"./createLucideIcon-DhOTYlCm.js";import"./index-d89-VRCp.js";import"./index-C6DuYNlM.js";import"./index--1ygw0mz.js";import"./index-D9Y9XxbS.js";import"./calendar-C06wmWHl.js";import"./index-DbDOfuCE.js";function Oe({job:a,customers:S,addresses:w,collection_types:B,sanitisation_options:V,status_options:M,staff_members:C,sub_clients:A}){var k,E,q,L;const[I,F]=f.useState(!1),O=()=>{F(!0),T.delete(`/collections/${a.id}`,{onSuccess:()=>{v.success("Job successfully deleted!"),T.get("/collections")},onError:()=>{v.error("Failed to delete job. Please try again."),F(!1)}})},[l,h]=f.useState({job_id:a.job_id||"",client_id:((k=a.client_id)==null?void 0:k.toString())||"",collection_date:a.collection_date?new Date(a.collection_date).toISOString().split("T")[0]:"",job_status:a.job_status||"",staff_collecting:a.staff_collecting||"",vehicle:a.vehicle||"",driver_carrier_registration:a.driver_carrier_registration||"",address:a.address||"",address_2:a.address_2||"",town_city:a.town_city||"",postcode:a.postcode||"",onsite_contact:a.onsite_contact||"",onsite_number:a.onsite_number||"",onsite_email:a.onsite_email||"",collection_type:((E=a.collection_type)==null?void 0:E.toString())||"",data_sanitisation:a.data_sanitisation||"",sla:a.sla||"",instructions:a.instructions||"",equipment_location:a.equipment_location||"",building_access:a.building_access||"",collection_route:a.collection_route||"",parking_loading:a.parking_loading||"",equipment_readiness:a.equipment_readiness||"",driver_type:a.driver_type||""}),[R,D]=f.useState(!1),t=s=>{const{name:c,value:r}=s.target;h(g=>({...g,[c]:r}))},_=(s,c)=>{h(r=>({...r,[s]:c}))},J=s=>{if(s==="manual"){h(r=>({...r,staff_collecting:"",vehicle:"",driver_type:"",carrier_registration:""}));return}const c=C.find(r=>r.id.toString()===s);c&&h(r=>({...r,staff_collecting:c.name,driver_type:c.driver_type||"",vehicle:c.driver_type==="external"?c.external_vehicle_registration||"":"TESTREG",driver_carrier_registration:c.driver_type==="external"&&c.carrier_registration||""}))},$=s=>{if(s==="manual"){h(r=>({...r,address:"",address_2:"",town_city:"",county:"",postcode:""}));return}if(s==="main"){i&&h(r=>({...r,address:i.address||"",address_2:i.address_2||"",town_city:i.town_city||"",county:i.county||"",postcode:i.postcode||""}));return}const c=w.find(r=>r.id.toString()===s);c&&h(r=>({...r,address:c.address,address_2:c.address_2,town_city:c.town_city,county:c.county||"",postcode:c.postcode}))},G=s=>{if(s==="manual"){h(r=>({...r,onsite_contact:"",onsite_number:"",onsite_email:""}));return}if(s==="main"&&i){h(r=>({...r,onsite_contact:i.contact_name||"",onsite_number:i.mobile||i.landline||"",onsite_email:i.email||""}));return}const c=A.find(r=>r.id.toString()===s);c&&h(r=>({...r,onsite_contact:c.name,onsite_number:c.mobile||c.landline||"",onsite_email:c.email}))},H=async()=>{var s,c,r;try{D(!0);const g={...l,collection_type:l.collection_type?parseInt(l.collection_type):null};console.log("Saving data:",g),(await z.put(`/collections/${a.id}`,g)).status===200?v.success("Changes saved successfully!"):v.error("Failed to save changes. Please try again.")}catch(g){console.error("Save error:",((s=g.response)==null?void 0:s.data)||g),v.error(((r=(c=g.response)==null?void 0:c.data)==null?void 0:r.message)||"An error occurred while saving changes.")}finally{D(!1)}},i=S.find(s=>s.id.toString()===l.client_id);return e.jsxs(K,{children:[e.jsx(Q,{}),e.jsxs(U,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(W,{className:"-ml-1"}),e.jsx(m,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(X,{children:e.jsxs(Y,{children:[e.jsx(b,{children:e.jsx(N,{href:"/dashboard",children:"Dashboard"})}),e.jsx(P,{}),e.jsx(b,{children:e.jsx(N,{href:"/collections",children:"Collections"})}),e.jsx(P,{}),e.jsx(b,{children:e.jsx(N,{href:"#",children:"Edit Job"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-3xl font-semibold text-gray-800",children:["Collection: ",a.job_id]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y,{variant:"outline",onClick:()=>window.location.href=`/collections/${a.id}`,children:[e.jsx(te,{className:"h-6 w-6"}),"Done Editing"]}),e.jsxs(y,{className:"bg-green-500 text-white hover:bg-green-600 focus:ring-2 focus:ring-green-400",onClick:H,disabled:R,children:[e.jsx(de,{className:"h-6 w-6"}),"Save Changes"]}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(y,{className:"bg-red-500 text-white hover:bg-red-600 focus:ring-2 focus:ring-red-400",disabled:I,children:[e.jsx(oe,{className:"h-6 w-6"}),"Delete Job"]})}),e.jsxs(se,{children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"Confirm Deletion"}),e.jsx(ae,{children:"Are you sure you want to delete this job? This action cannot be undone."})]}),e.jsxs(le,{children:[e.jsx(re,{children:"Cancel"}),e.jsx(ce,{onClick:O,children:"Delete"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg",children:[e.jsx("header",{className:"p-6",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Collection Details"})}),e.jsx(m,{}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"job_id",children:"Job Number*"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"job_id",name:"job_id",value:l.job_id,onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"client_id",children:"Customer*"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(x,{value:l.client_id,onValueChange:s=>_("client_id",s),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Select Customer"})}),e.jsx(u,{children:S.map(s=>e.jsx(o,{value:s.id.toString(),children:s.company_name||s.name},s.id))})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"job_status",children:"Status*"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(x,{value:l.job_status,onValueChange:s=>_("job_status",s),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Select Status"})}),e.jsx(u,{children:M.map(s=>e.jsx(o,{value:s,children:s},s))})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"collection_date",children:"Collection Date"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"collection_date",name:"collection_date",type:"date",value:l.collection_date,onChange:t})})]})]}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"staff_select",children:"Staff Collecting"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(x,{onValueChange:J,children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Enter Manually"})}),e.jsxs(u,{children:[e.jsx(o,{value:"manual",children:"Enter Manually"}),C.map(s=>e.jsx(o,{value:s.id.toString(),children:s.name},s.id))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"staff_collecting",children:"Name"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"staff_collecting",name:"staff_collecting",value:l.staff_collecting,onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"vehicle",children:"Vehicle"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"vehicle",name:"vehicle",value:l.vehicle,onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"driver_carrier_registration",children:"Carrier Registration"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"driver_carrier_registration",name:"driver_carrier_registration",value:l.driver_carrier_registration,onChange:t})})]})]}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"collection_address",children:"Collection Address"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(x,{onValueChange:$,children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Enter Manually"})}),e.jsxs(u,{children:[e.jsx(o,{value:"manual",children:"Enter Manually"}),i&&i.address&&e.jsxs(o,{value:"main",children:[i.address,", ",i.address_2,", ",i.town_city,", ",i.postcode," (Account Address)"]}),w.map(s=>e.jsxs(o,{value:s.id.toString(),children:[s.address,", ",s.address_2,", ",s.town_city,", ",s.postcode]},s.id))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"address",children:"Address Line 1"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"address",name:"address",value:l.address,onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"address_2",children:"Address Line 2"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"address_2",name:"address_2",value:l.address_2,onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"town_city",children:"Town/City"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"town_city",name:"town_city",value:l.town_city,onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"county",children:"County"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"county",name:"county",value:l.county||"",onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"postcode",children:"Postcode"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"postcode",name:"postcode",value:l.postcode,onChange:t})})]})]}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"onsite_contact_select",children:"Onsite Contact"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(x,{onValueChange:G,children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Enter Manually"})}),e.jsxs(u,{children:[e.jsx(o,{value:"manual",children:"Enter Manually"}),i&&i.contact_name&&e.jsxs(o,{value:"main",children:[i.contact_name," (Main Contact)"]}),A.map(s=>e.jsx(o,{value:s.id.toString(),children:s.name},s.id))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"onsite_contact",children:"Onsite Contact Name"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"onsite_contact",name:"onsite_contact",value:l.onsite_contact,onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"onsite_number",children:"Onsite Contact Number"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"onsite_number",name:"onsite_number",value:l.onsite_number,onChange:t})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"onsite_email",children:"Onsite Contact Email"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"onsite_email",name:"onsite_email",type:"email",value:l.onsite_email,onChange:t})})]}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"collection_type",children:"Collection Type*"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(x,{value:((q=l.collection_type)==null?void 0:q.toString())||"",onValueChange:s=>_("collection_type",s),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Select Collection Type"})}),e.jsx(u,{children:B.map(s=>e.jsx(o,{value:s.id.toString(),children:s.colt_name},s.id))})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"data_sanitisation",children:"Data Sanitisation*"}),e.jsx("div",{className:"col-span-2",children:e.jsxs(x,{value:((L=l.data_sanitisation)==null?void 0:L.toString())||"",onValueChange:s=>_("data_sanitisation",s),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Select Data Sanitisation"})}),e.jsx(u,{children:V.map(s=>e.jsx(o,{value:s.id.toString(),children:s.ds_name},s.id))})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{htmlFor:"sla",children:"Service Level Agreement"}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"sla",name:"sla",value:l.sla,onChange:t})})]})]})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg self-start",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Customer Details"}),e.jsxs("div",{className:"text-sm",children:["Account Status: ",e.jsx("span",{className:"text-green-500",children:"Active"})]})]}),e.jsx("hr",{className:"my-0"}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Company Name"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.company_name)||(i==null?void 0:i.name)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Address Line 1"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.address)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Address Line 2"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.address_2)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Town/City"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.town_city)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"County"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.county)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Postcode"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.postcode)||"-"})})]})]}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Contact Name"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.contact_name)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Position"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.position)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Landline"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.landline)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Mobile"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.mobile)||"-"})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(n,{children:"Email"}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{children:(i==null?void 0:i.email)||"-"})})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"equipment_location",children:"Equipment Location"}),e.jsx("textarea",{id:"equipment_location",name:"equipment_location",rows:4,placeholder:"Please enter any notes about Equipment Location here...",className:"w-full min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:l.equipment_location,onChange:t})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"building_access",children:"Building Access"}),e.jsx("textarea",{id:"building_access",name:"building_access",rows:4,placeholder:"Please enter any notes about Building Access here...",className:"w-full min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:l.building_access,onChange:t})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"collection_route",children:"Collection Route"}),e.jsx("textarea",{id:"collection_route",name:"collection_route",rows:4,placeholder:"Please enter any notes about this job here...",className:"w-full min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:l.collection_route,onChange:t})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"collection_route",children:"Parking & Loading"}),e.jsx("textarea",{id:"parking_loading",name:"parking_loading",rows:4,placeholder:"Please enter any notes about Parking & Loading here...",className:"w-full min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:l.parking_loading,onChange:t})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"equipment_readiness",children:"Equipment Readiness"}),e.jsx("textarea",{id:"equipment_readiness",name:"equipment_readiness",rows:4,placeholder:"Please enter any notes about Equipment Readiness here...",className:"w-full min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:l.equipment_readiness,onChange:t})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"collection_route",children:"Other Information"}),e.jsx("textarea",{id:"instructions",name:"instructions",rows:4,placeholder:"Please enter any notes about this job here...",className:"w-full min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:l.instructions,onChange:t})]})]})]})]})]})]})]})]})}export{Oe as default};
