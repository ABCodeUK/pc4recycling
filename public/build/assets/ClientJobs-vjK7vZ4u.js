import{r,j as e,b as m}from"./app-DUv4C8zR.js";import{S as I}from"./separator-52U-weNF.js";import{DataTable as E}from"./data-table-BhLsGDba.js";import{clientJobColumns as L}from"./columns-CR9dmb6l.js";import{I as h}from"./input-ER8UZmlu.js";import{L as j}from"./label-Dmu6HX2v.js";import{D as T,a as A,b as O,c as V,d as k,e as B,f as $}from"./dialog-BeE9kzvs.js";import{S as H,a as M,b as P,c as R,d as q}from"./select-Cce2oJH8.js";import{t as n}from"./index-DfymCQFU.js";import{B as x}from"./button-ByXYoKeZ.js";import"./index-XC-7eegb.js";import"./index-DeR6T8Ux.js";import"./utils-CytzSlOG.js";import"./table-BXRjnKkf.js";import"./badge-CBKa4bKq.js";import"./index-BwobEAja.js";import"./arrow-up-down-BWvk7nKp.js";import"./createLucideIcon-D1MVXgdA.js";import"./user-Bn2qYsPa.js";import"./eye-ouWPq0zm.js";import"./index-B9HSr1Oe.js";import"./index-Bi2U6H-I.js";import"./index-Lcj1GtjH.js";import"./index-Ct7uzItS.js";import"./index-5RnjzhFd.js";import"./index-CAh_ZuFR.js";import"./index-D1LanMWQ.js";function ge({parentId:l}){const[S,_]=r.useState([]),[c,C]=r.useState(""),[w,p]=r.useState(!1),[u,D]=r.useState(""),[b,f]=r.useState(!1),[z,v]=r.useState({}),N=["Needs Scheduling","Scheduled","Postponed"],[i,d]=r.useState({job_id:"",collection_date:"",job_status:"Needs Scheduling"});r.useEffect(()=>{const t=async()=>{try{const s=await m.get(`/customers/${l}/jobs`);_(s.data)}catch{n.error("Failed to fetch jobs.")}},o=async()=>{try{const s=await m.get("/collections/next-job-id");D(s.data.next_job_id),d(a=>({...a,job_id:s.data.next_job_id}))}catch(s){console.error("Failed to fetch next job ID:",s)}};l&&(t(),o())},[l]);const g=t=>{const{name:o,value:s}=t.target;d(a=>({...a,[o]:s}))},J=t=>{d(o=>({...o,job_status:t}))},y=async()=>{var t,o;try{f(!0);const s={job_id:i.job_id||u,client_id:l,job_status:i.job_status,collection_date:i.collection_date||null},a=await m.post("/collections",s);a.data&&(n.success("Job created successfully!"),window.location.href=`/collections/${a.data.id}/edit`)}catch(s){(o=(t=s.response)==null?void 0:t.data)!=null&&o.errors?(v(s.response.data.errors),Object.values(s.response.data.errors).forEach(a=>{n.error(a[0])})):n.error("Failed to create job.")}finally{f(!1)}},F=S.filter(t=>t.job_id.toLowerCase().includes(c.toLowerCase())||t.address.toLowerCase().includes(c.toLowerCase()));return e.jsxs("section",{className:"bg-white border shadow rounded-lg",children:[e.jsx("header",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Manage Jobs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View and manage all jobs for this customer."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{placeholder:"Search Jobs...",value:c,onChange:t=>C(t.target.value),className:"max-w-sm"}),e.jsxs(T,{open:w,onOpenChange:p,children:[e.jsx(A,{asChild:!0,children:e.jsx(x,{children:"Add New Job"})}),e.jsxs(O,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(V,{children:[e.jsx(k,{children:"Create New Job"}),e.jsx(B,{children:"Fill in the details for the new job below."})]}),e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"job_id",children:"Job ID"}),e.jsx(h,{id:"job_id",name:"job_id",value:i.job_id||u,onChange:g})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"collection_date",children:"Collection Date (Optional)"}),e.jsx(h,{id:"collection_date",name:"collection_date",type:"date",value:i.collection_date,onChange:g})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"job_status",children:"Status"}),e.jsxs(H,{value:i.job_status,onValueChange:J,children:[e.jsx(M,{children:e.jsx(P,{placeholder:"Select status"})}),e.jsx(R,{children:N.map(t=>e.jsx(q,{value:t,children:t},t))})]})]})]})}),e.jsxs($,{children:[e.jsx(x,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(x,{onClick:y,disabled:b,children:b?"Creating...":"Create Job"})]})]})]})]})]})}),e.jsx(I,{}),e.jsx("div",{className:"p-6",children:e.jsx(E,{columns:L,data:F})})]})}export{ge as default};
