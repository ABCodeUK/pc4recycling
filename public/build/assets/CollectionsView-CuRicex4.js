import{r as w,j as e,b as z,h as I}from"./app-Cma8V3l9.js";import{S as C,A as T,a as P,b as U,B as q,c as J,d as D,e as k,f as A,R as d}from"./breadcrumb-Cr6GXjz3.js";import{S as m}from"./separator-CEPuzrhi.js";import{B as c}from"./button-DS1ZOJ9c.js";import{I as _}from"./input-_RUYSLpp.js";import{t as h}from"./index-C_iezvca.js";import R from"./JobItems-DKdV3wSb.js";import O from"./JobAuditLog-C8LOvarD.js";import{U as g,F as N}from"./upload-DYO_bGoo.js";import{A as $}from"./arrow-left-TMV1_Fg0.js";import{S as V}from"./square-pen-DsVzVgxC.js";import{T as v}from"./trash-2-DUTB_MOx.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-BH7C-wFc.js";import"./createLucideIcon-BnM-jrHn.js";import"./index-jFmiJHnk.js";import"./index-rOaI9F-v.js";import"./index-BUxlmQ7d.js";import"./index-Dp-u-l4U.js";import"./index-DHxxav9I.js";import"./index-CoYLIXTa.js";import"./index-CJRq-bCV.js";import"./index-Cdv8n69u.js";import"./index-CIrE5OO0.js";import"./calendar-TwlUnTX4.js";import"./tabs-sJVBdolV.js";import"./data-table-Bc6rbH-u.js";import"./table-vJebbvAp.js";import"./columns-DC49rau_.js";import"./select-DcwlFvdE.js";import"./index-CrYhDhYK.js";import"./maximize-2-bAdWuGOe.js";import"./CollectionSignatureDialog-BovADmw7.js";import"./checkbox-g5XuN9uX.js";import"./extends-CF3RwP-h.js";import"./dialog-C3tgJ_8I.js";import"./label-IUEK5zVZ.js";import"./badge-CVzXI77s.js";import"./pencil-D9zWYp8h.js";function Fe({job:t,customers:E,documents:F}){w.useState(!1);const[i,f]=w.useState(F||{collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:[]}),[p,S]=w.useState({collection_manifest:null,hazard_waste_note:null,data_destruction_certificate:null,other:null}),j=async a=>{const x=p[a];if(!x)return;const r=new FormData;r.append("document",x),r.append("document_type",a);try{const n=await z.post(`/collections/${t.id}/documents`,r,{headers:{"Content-Type":"multipart/form-data"}});n.data&&(f(a==="other"?o=>({...o,other:[...o.other,n.data.document]}):o=>({...o,[a]:n.data.document})),S(o=>({...o,[a]:null})),h.success("Document uploaded successfully"))}catch(n){console.error("Upload error:",n),h.error("Failed to upload document")}},b=(a,x)=>{var n;const r=(n=a.target.files)==null?void 0:n[0];if(r){if(r.size>134217728){h.error("File size must be less than 128MB"),a.target.value="";return}S(y=>({...y,[x]:r}))}};c,p.collection_manifest,g;const u=(a,x)=>{I.delete(`/collections/${t.id}/documents/${a}`,{preserveScroll:!0,onSuccess:()=>{f(x==="other"?r=>({...r,other:r.other.filter(n=>n.id!==a)}):r=>({...r,[x]:null})),h.success("Document deleted successfully")},onError:()=>{h.error("Failed to delete document")}})},l=({label:a,value:x})=>e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:a}),e.jsx("dd",{className:"text-sm text-gray-900 text-left",children:x||"-"})]}),L=a=>a==="Active"?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",M=a=>{switch(a){case"Scheduled":return"bg-green-100 text-green-800 border-green-200";case"Postponed":case"Cancelled":return"bg-red-100 text-red-800 border-red-200";case"Collected":case"Processing":case"Complete":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},s=E.find(a=>a.id===t.client_id),B=t.collection_date?new Date(t.collection_date).toLocaleDateString():"-";return e.jsxs(C,{children:[e.jsx(T,{}),e.jsxs(P,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(U,{className:"-ml-1"}),e.jsx(m,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(q,{children:e.jsxs(J,{children:[e.jsx(D,{children:e.jsx(k,{href:"/dashboard",children:"Dashboard"})}),e.jsx(A,{}),e.jsxs(d,{role:"Developer|Administrator|Employee|Manager|Director",children:[e.jsx(D,{children:e.jsx(k,{href:"/collections",children:"Collections"})}),e.jsx(A,{})]}),e.jsx(D,{children:e.jsx(k,{href:"#",children:"View Job"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"text-3xl font-semibold text-gray-800",children:["Collection: ",t.job_id]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsxs(c,{variant:"outline",onClick:()=>window.location.href="/collections",children:[e.jsx($,{className:"h-6 w-6"}),"Back to Collections"]})}),e.jsx(d,{role:"Drivers",children:e.jsxs(c,{variant:"outline",onClick:()=>window.location.href="/dashboard",children:[e.jsx($,{className:"h-6 w-6"}),"Back to Dashboard"]})}),e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsxs(c,{onClick:()=>window.location.href=`/collections/${t.id}/edit`,children:[e.jsx(V,{className:"h-6 w-6"}),"Edit Job"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:["Collection Details",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${M(t.job_status)}`,children:t.job_status})]})]}),e.jsx(m,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(l,{label:"Job Number",value:t.job_id}),e.jsxs("div",{className:"py-1 grid grid-cols-2",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Customer"}),e.jsxs("dd",{className:"text-sm text-left",children:[e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx("a",{href:`/customers/${s==null?void 0:s.id}`,className:"text-primary hover:text-primary/90",children:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"})}),e.jsx(d,{role:"Drivers",children:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"})]})]}),e.jsx(l,{label:"Collection Date",value:B}),e.jsx(m,{className:"my-2"}),e.jsx(l,{label:"Staff Collecting",value:t.staff_collecting||"-"}),e.jsx(l,{label:"Vehicle",value:t.vehicle||"-"}),e.jsx(m,{className:"my-2"}),e.jsx(l,{label:"Address Line 1",value:t.address}),e.jsx(l,{label:"Address Line 2",value:t.address_2}),e.jsx(l,{label:"Town/City",value:t.town_city}),e.jsx(l,{label:"Postcode",value:t.postcode}),e.jsx(m,{className:"my-2"}),e.jsx(l,{label:"Onsite Contact",value:t.onsite_contact||"-"}),e.jsx(l,{label:"Onsite Number",value:t.onsite_number||"-"}),e.jsx(l,{label:"Onsite Email",value:t.onsite_email||"-"})]})]}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"More Information"}),e.jsx(m,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(l,{label:"Collection Type",value:t.collection_type||"-"}),e.jsx(l,{label:"Data Sanitisation",value:t.data_sanitisation||"-"}),e.jsx(l,{label:"Service Level Agreement",value:t.sla||"-"}),e.jsx(m,{className:"my-2"}),e.jsx(l,{label:"Equipment Location",value:t.equipment_location||"-"}),e.jsx(l,{label:"Building Access",value:t.building_access||"-"}),e.jsx(l,{label:"Collection Route",value:t.collection_route||"-"}),e.jsx(l,{label:"Parking & Loading",value:t.parking_loading||"-"}),e.jsx(l,{label:"Equipment Readiness",value:t.equipment_readiness||"-"}),e.jsx(m,{className:"my-2"}),e.jsxs("div",{className:"py-1",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Other Information"}),e.jsx("dd",{className:"mt-2 text-sm text-gray-900",children:t.instructions||"No instructions provided."})]})]})]}),e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold leading-7 text-gray-900 flex justify-between items-center",children:["Customer Details",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Account:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium border ${L(s==null?void 0:s.account_status)}`,children:(s==null?void 0:s.account_status)||"Disabled"})]})]}),e.jsx(m,{className:"my-4"}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsx(l,{label:"Company Name",value:(s==null?void 0:s.company_name)||(s==null?void 0:s.name)||"-"}),e.jsx(l,{label:"Address Line 1",value:(s==null?void 0:s.address)||"-"}),e.jsx(l,{label:"Address Line 2",value:(s==null?void 0:s.address_2)||"-"}),e.jsx(l,{label:"Town/City",value:(s==null?void 0:s.town_city)||"-"}),e.jsx(l,{label:"County",value:(s==null?void 0:s.county)||"-"}),e.jsx(l,{label:"Postcode",value:(s==null?void 0:s.postcode)||"-"}),e.jsx(m,{className:"my-2"}),e.jsx(l,{label:"Contact Name",value:(s==null?void 0:s.contact_name)||"-"}),e.jsx(l,{label:"Position",value:(s==null?void 0:s.position)||"-"}),e.jsx(l,{label:"Landline",value:(s==null?void 0:s.landline)||"-"}),e.jsx(l,{label:"Mobile",value:(s==null?void 0:s.mobile)||"-"}),e.jsx(l,{label:"Email",value:(s==null?void 0:s.email)||"-"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Job Documents"})}),e.jsx(d,{role:"Drivers",children:e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Collection Images"})}),e.jsx(m,{className:"my-4"}),e.jsx("div",{className:"space-y-6",children:e.jsxs(d,{role:"Developer|Administrator|Employee|Manager|Director",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Collection Manifest"}),e.jsx("div",{className:"flex gap-2 items-center",children:i.collection_manifest?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${t.id}/${i.collection_manifest.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),i.collection_manifest.original_filename]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>i.collection_manifest&&u(i.collection_manifest.id,"collection_manifest"),children:e.jsx(v,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{type:"file",accept:".pdf",onChange:a=>b(a,"collection_manifest")}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>j("collection_manifest"),disabled:!p.collection_manifest,children:e.jsx(g,{className:"h-4 w-4"})})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Hazard Waste Note"}),e.jsx("div",{className:"flex gap-2 items-center",children:i.hazard_waste_note?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${t.id}/${i.hazard_waste_note.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),i.hazard_waste_note.original_filename]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>i.hazard_waste_note&&u(i.hazard_waste_note.id,"hazard_waste_note"),children:e.jsx(v,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{type:"file",accept:".pdf",onChange:a=>b(a,"hazard_waste_note")}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>j("hazard_waste_note"),disabled:!p.hazard_waste_note,children:e.jsx(g,{className:"h-4 w-4"})})]})})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Data Destruction Certificate"}),e.jsx("div",{className:"flex gap-2 items-center",children:i.data_destruction_certificate?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`/documents/${t.id}/${i.data_destruction_certificate.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),i.data_destruction_certificate.original_filename]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>i.data_destruction_certificate&&u(i.data_destruction_certificate.id,"data_destruction_certificate"),children:e.jsx(v,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{type:"file",accept:".pdf",onChange:a=>b(a,"data_destruction_certificate")}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>j("data_destruction_certificate"),disabled:!p.data_destruction_certificate,children:e.jsx(g,{className:"h-4 w-4"})})]})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Other Documents"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(_,{type:"file",accept:".pdf",onChange:a=>b(a,"other")}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>j("other"),disabled:!p.other,children:e.jsx(g,{className:"h-4 w-4"})})]}),i.other.filter(a=>!a.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).length>0&&e.jsx("div",{className:"space-y-2",children:i.other.filter(a=>!a.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(a=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("a",{href:`/documents/${t.id}/${a.uuid}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/90 flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),a.original_filename]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>u(a.id,"other"),children:e.jsx(v,{className:"h-4 w-4 text-red-500"})})]},a.id))})]})]}),e.jsx(m,{className:"my-4"})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Collection Images"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center w-full",children:e.jsxs("label",{className:"relative group cursor-pointer w-full",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>{Array.from(a.target.files||[]).forEach(r=>{const n=new FormData;n.append("document",r),n.append("document_type","other"),z.post(`/collections/${t.id}/documents`,n,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{o.data&&(f(y=>({...y,other:[...y.other,o.data.document]})),h.success(`Uploaded ${r.name}`))}).catch(o=>{console.error("Upload error:",o),h.error(`Failed to upload ${r.name}`)})})}}),e.jsx("div",{className:"flex items-center justify-center gap-4 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary transition-colors bg-gray-50/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"h-5 w-5 text-gray-400 group-hover:text-primary transition-colors"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-primary",children:"Upload images"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Drag and drop or click to select"})]})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:i.other.filter(a=>a.original_filename.match(/\.(jpg|jpeg|png|gif|webp)$/i)).map(a=>e.jsxs("div",{className:"relative group aspect-square",children:[e.jsx("img",{src:`/storage/${a.file_path}`,alt:a.original_filename,className:"w-full h-full object-cover rounded-lg shadow-sm"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-200 rounded-lg flex items-end justify-between p-2",children:[e.jsx("a",{href:`/storage/${a.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/30 transition-colors",children:e.jsx(N,{className:"h-3.5 w-3.5 text-white"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>u(a.id,"other"),className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-full hover:bg-red-500/30 transition-colors",children:e.jsx(v,{className:"h-3.5 w-3.5 text-white"})})]})]},a.id))})]})]})]}),e.jsx(d,{role:"Developer|Administrator|Employee|Manager|Director",children:e.jsx(O,{jobId:t.id})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("section",{children:e.jsx(R,{jobId:t.job_id,jobStatus:t.job_status})})})]})]})]})}export{Fe as default};
