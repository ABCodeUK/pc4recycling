import{r,j as e,b as v}from"./app-C9fBnuOE.js";import{S as $,A as z,a as H,b as K,B as W,c as X,d as y,e as w,f as Y}from"./breadcrumb-DJSYhXrx.js";import{S as D}from"./separator-qcrg4dPm.js";import{B as d}from"./button-B_fIfnBb.js";import{I as u}from"./input-qWEfNBQH.js";import{L as m}from"./label-DXs1eXQv.js";import{DataTable as G}from"./data-table-CHt1h9w3.js";import{columns as Q}from"./columns-JbsCQvI0.js";import{D as U,a as Z,b as ee,c as te,d as se,e as ae,f as oe}from"./dialog-CjVGXQRN.js";import{S as I,a as F,b as J,c as A,d as E}from"./select-Dl6e1rl2.js";import{t as b}from"./index-BFwC0R9V.js";import{E as ie}from"./eye-BTD1d7_4.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-JjatSUmS.js";import"./createLucideIcon-D4c-ObJW.js";import"./index-Dfe5dhDQ.js";import"./index-CNTKN5Ut.js";import"./index-DUsJq6sw.js";import"./index-CsWbMgBq.js";import"./index-Ds3v4yF_.js";import"./index-CWtl1gFV.js";import"./index-B-UXHqoX.js";import"./index-CoIQ1zsl.js";import"./calendar-WOkk4oO4.js";import"./table-DZdrIWYD.js";import"./arrow-up-down-D2rOcEQ4.js";import"./user-BC2GcKWG.js";function Oe({jobs:T,customers:B,collection_types:re,sanitisation_options:le,status_options:L}){const[k,ne]=r.useState(T),[h,O]=r.useState(""),[i,f]=r.useState({}),[x,q]=r.useState(""),[_,g]=r.useState(!1),[P,j]=r.useState(!1),[o,p]=r.useState({job_id:"",client_id:"",collection_date:"",job_status:"Needs Scheduling",staff_collecting:"",vehicle:"",address:"",town_city:"",postcode:"",onsite_contact:"",onsite_number:"",onsite_email:"",collection_type:"",data_sanitisation:"",sla:"",instructions:""});r.useEffect(()=>{(async()=>{try{const s=await v.get("/collections/next-job-id");O(s.data.next_job_id),p(a=>({...a,job_id:s.data.next_job_id}))}catch(s){console.error("Failed to fetch next job ID:",s)}})()},[]);const V=()=>f({}),S=t=>{const{name:s,value:a}=t.target;p(c=>({...c,[s]:a}))},C=(t,s)=>{p(a=>({...a,[t]:s}))},M=async()=>{var s,a,c,N;V();const t={};if(!o.job_id&&!h&&(t.job_id="Job ID is required"),o.client_id||(t.client_id="Customer is required"),Object.keys(t).length>0){f(t),b.error("Please fill in all required fields");return}try{g(!0);const l={job_id:o.job_id||h,client_id:parseInt(o.client_id),collection_date:o.collection_date||null,job_status:o.job_status||"Needs Scheduling",staff_collecting:"",vehicle:"",address:"",town_city:"",postcode:"",onsite_contact:"",onsite_number:"",onsite_email:"",collection_type:null,data_sanitisation:"",sla:"",instructions:""},n=await v.post("/collections",l,{headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}});(n.status===201||n.status===200)&&(b.success("Job created successfully"),window.location.href=`/collections/${n.data.id}`)}catch(l){console.error("Create error:",((a=l.response)==null?void 0:a.data)||l);const n=((N=(c=l.response)==null?void 0:c.data)==null?void 0:N.message)||"Failed to create job. Please try again.";b.error(n)}finally{g(!1),j(!1)}},R=[...Q,{id:"actions",header:"Actions",cell:({row:t})=>{const s=t.original;return e.jsx("div",{className:"flex justify-end space-x-2",children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>window.location.href=`/collections/${s.id}/`,children:e.jsx(ie,{className:"h-4 w-4"})})})}}];return e.jsxs($,{children:[e.jsx(z,{}),e.jsxs(H,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 bg-white border-b",children:[e.jsx(K,{className:"-ml-1"}),e.jsx(D,{orientation:"vertical",className:"h-4 mx-2"}),e.jsx(W,{children:e.jsxs(X,{children:[e.jsx(y,{children:e.jsx(w,{href:"/dashboard",children:"Dashboard"})}),e.jsx(Y,{}),e.jsx(y,{children:e.jsx(w,{href:"/collections",children:"Collections"})})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-8",children:[e.jsx("div",{className:"text-3xl font-semibold text-gray-800",children:"Jobs: Collections"}),e.jsxs("section",{className:"bg-white border shadow rounded-lg p-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold leading-7 text-gray-900",children:"Manage Collections"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View and manage collection jobs."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{placeholder:"Search Jobs...",value:x,onChange:t=>q(t.target.value),className:"max-w-sm"}),e.jsxs(U,{open:P,onOpenChange:j,children:[e.jsx(Z,{asChild:!0,children:e.jsx(d,{children:"Create New Job"})}),e.jsxs(ee,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(te,{children:[e.jsx(se,{children:"Create New Job"}),e.jsx(ae,{children:"Fill in the basic details for the new job. You can add more details after creation."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"job_id",children:"Job Number*"}),e.jsx(u,{id:"job_id",name:"job_id",value:o.job_id||h,onChange:t=>S(t)}),i.job_id&&e.jsx("p",{className:"text-red-600 text-sm",children:i.job_id})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"client_id",children:"Customer*"}),e.jsxs(I,{value:o.client_id,onValueChange:t=>C("client_id",t),children:[e.jsx(F,{children:e.jsx(J,{placeholder:"Select Customer"})}),e.jsx(A,{children:B.map(t=>e.jsx(E,{value:t.id.toString(),children:t.name},t.id))})]}),i.client_id&&e.jsx("p",{className:"text-red-600 text-sm",children:i.client_id})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"collection_date",children:"Collection Date (Optional)"}),e.jsx(u,{id:"collection_date",name:"collection_date",type:"date",value:o.collection_date,onChange:t=>S(t)}),i.collection_date&&e.jsx("p",{className:"text-red-600 text-sm",children:i.collection_date})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"job_status",children:"Status*"}),e.jsxs(I,{value:o.job_status,onValueChange:t=>C("job_status",t),children:[e.jsx(F,{children:e.jsx(J,{placeholder:"Select Status"})}),e.jsx(A,{children:L.filter(t=>["Needs Scheduling","Scheduled","Postponed"].includes(t)).map(t=>e.jsx(E,{value:t,children:t},t))})]}),i.job_status&&e.jsx("p",{className:"text-red-600 text-sm",children:i.job_status})]})]}),e.jsxs(oe,{children:[e.jsx(d,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(d,{onClick:M,disabled:_,children:_?"Creating...":"Create Job"})]})]})]})]})]}),e.jsx(D,{className:"my-4"}),e.jsx(G,{columns:R,data:k.filter(t=>{var s,a;return t.job_id.toLowerCase().includes(x.toLowerCase())||((a=(s=t.client)==null?void 0:s.company_name)==null?void 0:a.toLowerCase().includes(x.toLowerCase()))})})]})]})]})]})}export{Oe as default};
